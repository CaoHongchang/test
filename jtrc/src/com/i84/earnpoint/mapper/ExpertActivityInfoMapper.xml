<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.i84.earnpoint.mapper.ExpertActivityInfoMapper" >
  <resultMap id="BaseResultMap" type="com.i84.earnpoint.model.ExpertActivityInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="expert_id" property="expertId" jdbcType="INTEGER" />
    <result column="a_id" property="aId" jdbcType="INTEGER" />
    <result column="staff" property="staff" jdbcType="INTEGER" />
    <result column="add_date" property="addDate" jdbcType="TIMESTAMP" />
    <result column="del_date" property="delDate" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, expert_id, a_id, staff, add_date, del_date
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from expert_activity_info
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from expert_activity_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.i84.earnpoint.model.ExpertActivityInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into expert_activity_info (id, expert_id, a_id, 
      staff, add_date, del_date
      )
    values (#{id,jdbcType=INTEGER}, #{expertId,jdbcType=INTEGER}, #{aId,jdbcType=INTEGER}, 
      #{staff,jdbcType=INTEGER}, #{addDate,jdbcType=TIMESTAMP}, #{delDate,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.i84.earnpoint.model.ExpertActivityInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into expert_activity_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="expertId != null" >
        expert_id,
      </if>
      <if test="aId != null" >
        a_id,
      </if>
      <if test="staff != null" >
        staff,
      </if>
      <if test="addDate != null" >
        add_date,
      </if>
      <if test="delDate != null" >
        del_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="expertId != null" >
        #{expertId,jdbcType=INTEGER},
      </if>
      <if test="aId != null" >
        #{aId,jdbcType=INTEGER},
      </if>
      <if test="staff != null" >
        #{staff,jdbcType=INTEGER},
      </if>
      <if test="addDate != null" >
        #{addDate,jdbcType=TIMESTAMP},
      </if>
      <if test="delDate != null" >
        #{delDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.i84.earnpoint.model.ExpertActivityInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update expert_activity_info
    <set >
      <if test="expertId != null" >
        expert_id = #{expertId,jdbcType=INTEGER},
      </if>
      <if test="aId != null" >
        a_id = #{aId,jdbcType=INTEGER},
      </if>
      <if test="staff != null" >
        staff = #{staff,jdbcType=INTEGER},
      </if>
      <if test="addDate != null" >
        add_date = #{addDate,jdbcType=TIMESTAMP},
      </if>
      <if test="delDate != null" >
        del_date = #{delDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i84.earnpoint.model.ExpertActivityInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update expert_activity_info
    set expert_id = #{expertId,jdbcType=INTEGER},
      a_id = #{aId,jdbcType=INTEGER},
      staff = #{staff,jdbcType=INTEGER},
      add_date = #{addDate,jdbcType=TIMESTAMP},
      del_date = #{delDate,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="listExpertActivityInfo" resultType="java.util.HashMap" parameterType="java.util.HashMap">
  
  	 SELECT  a.id,a.uid,a.zpno,a.pro_type,a.zg_level,b.adr,b.tel,b.email,b.name,b.pnum,b.sex,a.company,a.login_times,a.init_time,a.other_time FROM user_expert_info a 
  	 INNER JOIN user_info b
     on a.uid=b.id  
     <if test="activityId!=null">
       INNER JOIN expert_activity_info c 
       on a.id=c.expert_id 
       WHERE a.del_date is null  
        and c.a_id = #{activityId,jdbcType=INTEGER} and c.del_date is null
     </if>
     <if test="activityId==null or activityId==''">
         where a.del_date is null
     </if>
     <if test="expertId!=null">
        and c.expert_id = #{expertId,jdbcType=INTEGER}
     </if> 
     <if test="expertName!=null and expertName!=''">
        and b.name like CONCAT('%',#{expertName,jdbcType=VARCHAR},'%')
     </if>
     <if test="proType!=null and proType!=''">
        and a.pro_type like CONCAT('%',#{proType,jdbcType=VARCHAR},'%')
     </if>
     <if test="zgLevel!=null and zgLevel!=''">
        and a.zg_level = #{zgLevel,jdbcType=VARCHAR}
     </if>
     
     <if test="zpno_serch!=null and zpno_serch!=''">
        and a.zpno like CONCAT('%',#{zpno_serch,jdbcType=VARCHAR},'%')
     </if>
     
     <if test="zj_name_serch!=null and zj_name_serch!=''">
        and b.name like CONCAT('%',#{zj_name_serch,jdbcType=VARCHAR},'%')
     </if>
     
     <if test="pnum_serch!=null and pnum_serch!=''">
        and b.pnum like CONCAT('%',#{pnum_serch,jdbcType=VARCHAR},'%')
     </if>
     
     <if test="pro_type_serch!=null and pro_type_serch!=''">
        and a.pro_type like CONCAT('%',#{pro_type_serch,jdbcType=VARCHAR},'%')
     </if>
     
      <if test="zg_level_serch!=null and zg_level_serch!=''">
        and a.zg_level like CONCAT('%',#{zg_level_serch,jdbcType=VARCHAR},'%')
     </if>
     
      and a.del_date is null and b.del_date is null
  </select>
  
    <select id="listExpertActivityInfo2" resultType="java.util.HashMap" parameterType="java.util.HashMap">
       
		SELECT
		<if test="isCount !=null ">
		count(1) total
		</if>
		<if test="isId !=null ">
		c.id
		</if>
		
		FROM
			user_expert_info a
		INNER JOIN user_info b ON a.uid = b.id
		INNER JOIN expert_activity_info c ON a.id = c.expert_id
		INNER JOIN zc_activity_info d on d.id=c.a_id
		where  a.del_date is null and b.del_date is null and  c.del_date is null and  d.del_date is null
  
        <if test="pnum2 !=null and pnum2 !=''">
        and b.pnum = #{pnum2,jdbcType=VARCHAR}
        </if>
        <if test="business_id !=null and business_id !=''">
        and d.business_id = #{business_id,jdbcType=VARCHAR}
        </if>
      <if test="name2 !=null and name2 !=''">
        and b.name = #{name2,jdbcType=VARCHAR}
     </if>
     <if test=" isCount !=null">
		  limit 1
	  </if>
  </select>
  
  
  <update id="deleteExpertActivityInfos" parameterType="java.util.HashMap">
     update expert_activity_info set del_date=CURRENT_TIMESTAMP where 1=1
     <if test="activityIds!=null">
         and  a_id in
        <foreach collection="activityIds" open="(" separator="," item="item" close=")">
             #{item,jdbcType=INTEGER}
        </foreach>
     </if>
     <if test="expertIds!=null">
           and expert_id in
        <foreach collection="expertIds" open="(" separator="," item="item" close=")">
             #{item,jdbcType=INTEGER}
        </foreach>
     </if>
  </update>
  <select id="listUserExpertInfoBySelective" resultType="java.util.HashMap" parameterType="java.util.HashMap">
  		SELECT
	  	a.id activityId,
		c.*,
		(
        SELECT
            COUNT(1)
        FROM
            zc_dissertation_score AS s
        WHERE
            s.expert_id = c.id
        and s.del_date is null
        ) as num
		FROM
			zc_activity_info a
		INNER JOIN expert_activity_info b ON a.id = b.a_id
		INNER JOIN user_expert_info c ON b.expert_id = c.id
		WHERE
			b.del_date IS NULL
		AND c.del_date IS NULL
	   <if test="company!=null">
	     and company !=#{company,jdbcType=VARCHAR}
	   </if>
	   <if test="major!=null">
	     and c.pro_type = #{major,jdbcType=VARCHAR}
	   </if>
	   <if test="activityId!=null">
	     and a.id =#{activityId,jdbcType=INTEGER}
	   </if>
	   <if test="expertIds!=null and expertIds.size()!=0">
	     and b.expert_id not in 
	     <foreach collection="expertIds" open="(" item="item" separator="," close=")">
	          #{item}
	     </foreach>
	   </if>
	    order by num
  </select>
  <select id="listUserExpertInfoBySelectiveAndVname" resultType="java.util.HashMap" parameterType="java.util.HashMap">
        SELECT
        a.id activityId,
        c.*,
        (
        SELECT
            COUNT(1)
        FROM
            zc_dissertation_score AS s
        WHERE
            s.expert_id = c.id
        and s.del_date is null
        and s.end_date is null
	    ) as num
        FROM
            zc_activity_info a
        INNER JOIN expert_activity_info b ON a.id = b.a_id
        INNER JOIN user_expert_info c ON b.expert_id = c.id
        WHERE
            b.del_date IS NULL
        AND c.del_date IS NULL
       <if test="company!=null">
         and company !=#{company,jdbcType=VARCHAR}
       </if>
       <if test="major!=null">
         and c.pro_type = #{major,jdbcType=VARCHAR}
       </if>
       <if test="activityId!=null">
         and a.id =#{activityId,jdbcType=INTEGER}
       </if>
       <if test="did !=null and did !='' ">
        AND c.id NOT IN (
			    SELECT
			        s.expert_id
			    FROM
			        zc_dissertation_score AS s
			    WHERE
			        s.r_id = #{did,jdbcType=INTEGER}
			    AND s.del_date IS NULL     
			)
       </if>
        order by num
  </select>
</mapper>