<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.i84.earnpoint.mapper.TypeInfoMapper">
	<resultMap id="BaseResultMap" type="com.i84.earnpoint.model.TypeInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="id" jdbcType="INTEGER" property="id" />
		<result column="pno" jdbcType="VARCHAR" property="pno" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="type_id" jdbcType="INTEGER" property="typeId" />
		<result column="type_value" jdbcType="VARCHAR" property="typeValue" />
		<result column="remark" jdbcType="VARCHAR" property="remark" />
		<result column="is_valid" jdbcType="CHAR" property="isValid" />
		<result column="seq" jdbcType="INTEGER" property="seq" />
		<result column="parent_id" jdbcType="INTEGER" property="parentId" />
		<result column="object_name" jdbcType="VARCHAR" property="objectName" />
		<result column="del_date" jdbcType="TIMESTAMP" property="delDate" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		id, pno, name, type_id, type_value, remark, is_valid, seq, parent_id,
		object_name,
		del_date
	</sql>
	<select id="selectByPrimaryKey" parameterType="java.lang.Integer"
		resultMap="BaseResultMap">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from type_info
		where del_date is null and id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from type_info
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.i84.earnpoint.model.TypeInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into type_info (id, pno, name,
		type_id, type_value, remark,
		is_valid, seq, parent_id,
		object_name, del_date)
		values
		(#{id,jdbcType=INTEGER}, #{pno,jdbcType=VARCHAR},
		#{name,jdbcType=VARCHAR},
		#{typeId,jdbcType=INTEGER},
		#{typeValue,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR},
		#{isValid,jdbcType=CHAR}, #{seq,jdbcType=INTEGER},
		#{parentId,jdbcType=INTEGER},
		#{objectName,jdbcType=VARCHAR},
		#{delDate,jdbcType=TIMESTAMP})
	</insert>
	<insert id="insertSelective" parameterType="com.i84.earnpoint.model.TypeInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into type_info
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="pno != null">
				pno,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="typeId != null">
				type_id,
			</if>
			<if test="typeValue != null">
				type_value,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="isValid != null">
				is_valid,
			</if>
			<if test="seq != null">
				seq,
			</if>
			<if test="parentId != null">
				parent_id,
			</if>
			<if test="objectName != null">
				object_name,
			</if>
			<if test="delDate != null">
				del_date,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="pno != null">
				#{pno,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="typeId != null">
				#{typeId,jdbcType=INTEGER},
			</if>
			<if test="typeValue != null">
				#{typeValue,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="isValid != null">
				#{isValid,jdbcType=CHAR},
			</if>
			<if test="seq != null">
				#{seq,jdbcType=INTEGER},
			</if>
			<if test="parentId != null">
				#{parentId,jdbcType=INTEGER},
			</if>
			<if test="objectName != null">
				#{objectName,jdbcType=VARCHAR},
			</if>
			<if test="delDate != null">
				#{delDate,jdbcType=TIMESTAMP},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.i84.earnpoint.model.TypeInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update type_info
		<set>
			<if test="pno != null">
				pno = #{pno,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="typeId != null">
				type_id = #{typeId,jdbcType=INTEGER},
			</if>
			<if test="typeValue != null">
				type_value = #{typeValue,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="isValid != null">
				is_valid = #{isValid,jdbcType=CHAR},
			</if>
			<if test="seq != null">
				seq = #{seq,jdbcType=INTEGER},
			</if>
			<if test="parentId != null">
				parent_id = #{parentId,jdbcType=INTEGER},
			</if>
			<if test="objectName != null">
				object_name = #{objectName,jdbcType=VARCHAR},
			</if>
			<if test="delDate != null">
				del_date = #{delDate,jdbcType=TIMESTAMP},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.i84.earnpoint.model.TypeInfo">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update type_info
		set pno = #{pno,jdbcType=VARCHAR},
		name =
		#{name,jdbcType=VARCHAR},
		type_id = #{typeId,jdbcType=INTEGER},
		type_value = #{typeValue,jdbcType=VARCHAR},
		remark =
		#{remark,jdbcType=VARCHAR},
		is_valid = #{isValid,jdbcType=CHAR},
		seq =
		#{seq,jdbcType=INTEGER},
		parent_id = #{parentId,jdbcType=INTEGER},
		object_name = #{objectName,jdbcType=VARCHAR},
		del_date =
		#{delDate,jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=INTEGER}
	</update>


	<select id="selectListByPrimaryKey" parameterType="com.i84.earnpoint.model.TypeInfo"
		resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from type_info
		where 1=1 and del_date is null and is_valid = 1 and
		type_id = 5
		<if test="parentId!=null">
			and parent_id = #{parentId,jdbcType=INTEGER}
		</if>
		order by parent_id ,seq asc
	</select>

	<select id="selectListByPrimary" parameterType="com.i84.earnpoint.model.TypeInfo"
		resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from type_info
		where is_valid=1 and parent_id = 0 and type_id=5 and
		del_date is null
		<if test="pno!=null">
			and pno = #{pno}
		</if>
		<if test="name!=null">
			and name like CONCAT('%',#{name},'%')
		</if>
	</select>

	<select id="selectChildListByPrimary" parameterType="com.i84.earnpoint.model.TypeInfo"
		resultMap="BaseResultMap">
		SELECT
		a.id,
		a.pno,
		a. NAME,
		a.type_id,
		a.type_value,
		a.is_valid,
		a.seq,
		a.parent_id,
		b.`name` AS typeName,
		c.id as childId,
		c.s_direct as
		sDirect,
		c.sstate as sstate,
		c.remark,
		c.pic1,
		c.pic2,
		c.pic3
		FROM
		type_info
		a,
		type_info b,
		rs_business_info c
		WHERE
		a.is_valid = 1
		AND a.parent_id !=
		0
		AND a.type_id = 5
		and b.parent_id = 0
		AND
		a.parent_id = b.id
		AND a.id =
		c.business_id
		and a.del_Date is null
		and b.del_date is null
		and
		c.parent_id = 0
		<if test="parentId != null">
			and a.parent_id = #{parentId,jdbcType=INTEGER}
		</if>
		<if test="pno!=null">
			and a.pno = #{pno}
		</if>
		<if test="name!=null">
			and a.name like CONCAT('%',#{name},'%')
		</if>
	</select>

	<select id="findByIds" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" />
		from type_info where del_date is null and parent_id in
		<foreach close=")" collection="array" index="index" item="item"
			open="(" separator=",">
			#{item}
		</foreach>
	</select>

	<select id="findByIds2" resultMap="BaseResultMap">
		select
		a.id,
		a.pno,
		a. NAME,
		a.type_id,
		a.type_value,
		a.is_valid,
		a.seq,
		a.parent_id,
		b.`name` AS typeName,
		c.id as childId,
		c.s_direct as
		sDirect,
		c.sstate as sstate,
		c.remark,
		c.pic1,
		c.pic2,
		c.pic3
		FROM
		type_info
		a,
		type_info b,
		rs_business_info c
		WHERE
		a.is_valid = 1
		AND a.parent_id !=
		0
		AND a.type_id = 5
		and b.parent_id = 0
		AND
		a.parent_id = b.id
		AND a.id =
		c.business_id
		and a.del_Date is null
		and b.del_date is null
		and
		c.parent_id = 0
		and a.parent_id in
		<foreach close=")" collection="array" index="index" item="item"
			open="(" separator=",">
			#{item}
		</foreach>
	</select>

	<delete id="deleteByPrimaryKeys">
         <![CDATA[
            delete from type_info where id in
         ]]>
		<foreach close=")" collection="array" index="index" item="item"
			open="(" separator=",">
			#{item}
		</foreach>
	</delete>

	<insert id="insertChild" keyProperty="id"
		parameterType="com.i84.earnpoint.model.TypeInfo" useGeneratedKeys="true">
		insert into type_info(pno, name,type_id,is_valid,parent_id)
		values(#{pno}, #{name},5,1,#{parentId})
	</insert>

	<update id="updateTypeInfo" parameterType="java.util.HashMap">

		update type_info
		<set>
			<if test="pno != null">
				pno = #{pno,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				name = #{name,jdbcType=VARCHAR},
			</if>
			<if test="typeId != null">
				type_id = #{typeId,jdbcType=INTEGER},
			</if>
			<if test="typeValue != null">
				type_value = #{typeValue,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				remark = #{remark,jdbcType=VARCHAR},
			</if>
			<if test="isValid != null">
				is_valid = #{isValid,jdbcType=CHAR},
			</if>
			<if test="seq != null">
				seq = #{seq,jdbcType=INTEGER},
			</if>
			<if test="parentId != null">
				parent_id = #{parentId,jdbcType=INTEGER},
			</if>
			<if test="objectName != null">
				object_name = #{objectName,jdbcType=VARCHAR},
			</if>
			<if test="delDate != null">
				del_date = #{delDate,jdbcType=TIMESTAMP},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<insert id="insertTypeInfo" parameterType="java.util.HashMap">

		insert into type_info
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="pno != null">
				pno,
			</if>
			<if test="name != null">
				name,
			</if>
			<if test="typeId != null">
				type_id,
			</if>
			<if test="typeValue != null">
				type_value,
			</if>
			<if test="remark != null">
				remark,
			</if>
			<if test="isValid != null">
				is_valid,
			</if>
			<if test="seq != null">
				seq,
			</if>
			<if test="parentId != null">
				parent_id,
			</if>
			<if test="objectName != null">
				object_name,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="pno != null">
				#{pno,jdbcType=VARCHAR},
			</if>
			<if test="name != null">
				#{name,jdbcType=VARCHAR},
			</if>
			<if test="typeId != null">
				#{typeId,jdbcType=INTEGER},
			</if>
			<if test="typeValue != null">
				#{typeValue,jdbcType=VARCHAR},
			</if>
			<if test="remark != null">
				#{remark,jdbcType=VARCHAR},
			</if>
			<if test="isValid != null">
				#{isValid,jdbcType=CHAR},
			</if>
			<if test="seq != null">
				#{seq,jdbcType=INTEGER},
			</if>
			<if test="parentId != null">
				#{parentId,jdbcType=INTEGER},
			</if>
			<if test="objectName != null">
				#{objectName,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>

	<select id="selectYwflList" resultType="java.util.HashMap"
		parameterType="java.util.HashMap">
		select
		<include refid="Base_Column_List" />
		from type_info
		where del_date is null and object_name in('个人','企业')
		<if test="id!=null and id!=''">
			and id=#{id,jdbcType=INTEGER}
		</if>
		<if test="parentId!=null">
			and parent_id = #{parentId,jdbcType=INTEGER}
		</if>
		<if test="pno !=null and pno !=''">
			and pno like CONCAT('%',#{pno},'%')
		</if>
		<if test="name !=null and name !=''">
			and name like CONCAT('%',#{name},'%')
		</if>
		<if test="objectName !=null and objectName !=''">
			and object_name=#{objectName,jdbcType=VARCHAR}
		</if>

		order by parent_id ,seq asc
	</select>

	<select id="getNextPno" resultType="java.lang.String">
		select
		pno
		from type_info
		where
		1=1 and type_id = 5
		order by pno desc limit 1
	</select>

	<select id="businessTypeStatistics" parameterType="com.i84.earnpoint.model.Statistical"
		resultType="java.util.HashMap">
		SELECT
		b.`name` AS ss,
		COUNT(b.`name`) AS num
		FROM
		rs_business_info a
		LEFT
		JOIN type_info b
		ON a.business_id = b.id
		LEFT JOIN type_info c
		ON
		a.parent_id = c.id
		INNER JOIN user_info d
		ON a.uid = d.id
		WHERE
		a.parent_id > 0
		AND a.sstate = 2
		<if test="year1 != null and year1 !='' ">
			AND a.add_date>=#{year1}
		</if>
		<if test="year2 != null and year2 !=''">
			AND #{year2} >=a.add_date
		</if>
		GROUP BY b.`name`
	</select>

	<select id="handle" parameterType="com.i84.earnpoint.model.Statistical"
		resultType="java.util.HashMap">
		SELECT
		<if test="timeType==null or timeType=='year'">
			concat(YEAR(birth_date),'年') year,
		</if>
		<if test=" timeType=='month'">
			concat(MONTH(birth_date),'月') year,
		</if>
		COUNT(*) as num
		FROM
		rs_business_info a
		LEFT JOIN type_info b
		ON
		a.business_id = b.id
		LEFT JOIN type_info c
		ON a.parent_id = c.id
		INNER
		JOIN user_info d
		ON a.uid = d.id
		WHERE a.parent_id > 0
		<if test="year1 != null and year1 !='' ">
			AND a.add_date>=#{year1}
		</if>
		<if test="year2 != null and year2 !=''">
			AND #{year2} >=a.add_date
		</if>
		<if test="timeType==null or timeType=='year'">
			GROUP BY YEAR(birth_date)
		</if>
		<if test=" timeType=='month'">
			GROUP BY MONTH(birth_date)
		</if>
	</select>
</mapper>