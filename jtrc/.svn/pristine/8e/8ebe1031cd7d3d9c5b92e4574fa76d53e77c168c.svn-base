<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.i84.earnpoint.mapper.ArchivesMaterialInfoMapper" >
  <resultMap id="BaseResultMap" type="com.i84.earnpoint.model.ArchivesMaterialInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="p_no" property="pNo" jdbcType="VARCHAR" />
    <result column="p_name" property="pName" jdbcType="VARCHAR" />
    <result column="p_url" property="pUrl" jdbcType="VARCHAR" />
    <result column="p_date" property="pDate" jdbcType="TIMESTAMP" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="stuff" property="stuff" jdbcType="INTEGER" />
    <result column="add_date" property="addDate" jdbcType="TIMESTAMP" />
    <result column="file_code" property="fileCode" jdbcType="VARCHAR" />
    <result column="file_name" property="fileName" jdbcType="VARCHAR" />
    <result column="page_num" property="pageNum" jdbcType="INTEGER" />
     <result column="sort" property="sort" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, p_no, p_name, p_url, p_date, remark, stuff, add_date, file_code, file_name, page_num
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from archives_material_info
    where id = #{id,jdbcType=INTEGER} and del_time not null
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from archives_material_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.i84.earnpoint.model.ArchivesMaterialInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into archives_material_info (id, p_no, p_name, 
      p_url, p_date, remark, 
      stuff, add_date, file_code, 
      file_name, page_num)
    values (#{id,jdbcType=INTEGER}, #{pNo,jdbcType=VARCHAR}, #{pName,jdbcType=VARCHAR}, 
      #{pUrl,jdbcType=VARCHAR}, #{pDate,jdbcType=TIMESTAMP}, #{remark,jdbcType=VARCHAR}, 
      #{stuff,jdbcType=INTEGER}, #{addDate,jdbcType=TIMESTAMP}, #{fileCode,jdbcType=VARCHAR}, 
      #{fileName,jdbcType=VARCHAR}, #{pageNum,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" useGeneratedKeys="true" keyProperty="id" parameterType="com.i84.earnpoint.model.ArchivesMaterialInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into archives_material_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="pNo != null" >
        p_no,
      </if>
      <if test="pName != null" >
        p_name,
      </if>
      <if test="pUrl != null" >
        p_url,
      </if>
      <if test="pDate != null" >
        p_date,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="stuff != null" >
        stuff,
      </if>
      <if test="addDate != null" >
        add_date,
      </if>
      <if test="fileCode != null" >
        file_code,
      </if>
      <if test="fileName != null" >
        file_name,
      </if>
      <if test="pageNum != null" >
        page_num,
      </if>
       <if test="sort != null" >
        sort,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="pNo != null" >
        #{pNo,jdbcType=VARCHAR},
      </if>
      <if test="pName != null" >
        #{pName,jdbcType=VARCHAR},
      </if>
      <if test="pUrl != null" >
        #{pUrl,jdbcType=VARCHAR},
      </if>
      <if test="pDate != null" >
        #{pDate,jdbcType=TIMESTAMP},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="stuff != null" >
        #{stuff,jdbcType=INTEGER},
      </if>
      <if test="addDate != null" >
        #{addDate,jdbcType=TIMESTAMP},
      </if>
      <if test="fileCode != null" >
        #{fileCode,jdbcType=VARCHAR},
      </if>
      <if test="fileName != null" >
        #{fileName,jdbcType=VARCHAR},
      </if>
      <if test="pageNum != null" >
        #{pageNum,jdbcType=INTEGER},
      </if>
      <if test="sort != null" >
         #{sort,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.i84.earnpoint.model.ArchivesMaterialInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update archives_material_info
    <set >
      <if test="pNo != null" >
        p_no = #{pNo,jdbcType=VARCHAR},
      </if>
      <if test="pName != null" >
        p_name = #{pName,jdbcType=VARCHAR},
      </if>
      <if test="pUrl != null" >
        p_url = #{pUrl,jdbcType=VARCHAR},
      </if>
     
        p_date = #{pDate,jdbcType=TIMESTAMP},
     
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="stuff != null" >
        stuff = #{stuff,jdbcType=INTEGER},
      </if>
      <if test="addDate != null" >
        add_date = #{addDate,jdbcType=TIMESTAMP},
      </if>
      <if test="fileCode != null" >
        file_code = #{fileCode,jdbcType=VARCHAR},
      </if>
      <if test="fileName != null" >
        file_name = #{fileName,jdbcType=VARCHAR},
      </if>
      <if test="pageNum != null" >
        page_num = #{pageNum,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i84.earnpoint.model.ArchivesMaterialInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update archives_material_info
    set p_no = #{pNo,jdbcType=VARCHAR},
      p_name = #{pName,jdbcType=VARCHAR},
      p_url = #{pUrl,jdbcType=VARCHAR},
      p_date = #{pDate,jdbcType=TIMESTAMP},
      remark = #{remark,jdbcType=VARCHAR},
      stuff = #{stuff,jdbcType=INTEGER},
      add_date = #{addDate,jdbcType=TIMESTAMP},
      file_code = #{fileCode,jdbcType=VARCHAR},
      file_name = #{fileName,jdbcType=VARCHAR},
      page_num = #{pageNum,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
   <select id="selectByPno" resultType="java.util.HashMap" parameterType="com.i84.earnpoint.model.ArchivesMaterialInfo">
    select a.id,file_code,file_name,page_num,date_format(a.add_date,'%Y-%m-%d') add_date,b.realName userName,date_format(a.p_date,'%Y-%m-%d') pdate,
    p_name pname,remark,p_url from archives_material_info a left join t_user b on a.stuff = b.userId
    where p_no = #{pNo,jdbcType=VARCHAR} and del_time is null order by sort 
  </select>
  
   <select id="selectAllGdMaterialsByPno" resultType="java.util.HashMap" parameterType="java.lang.String">
  SELECT
    *
FROM
    (
        SELECT
            p_date,
            p_no,
            p_name,
            page_num,
            DATE_FORMAT(p_date, '%Y') pyear,
            DATE_FORMAT(p_date, '%m') pmonth,
            DATE_FORMAT(p_date, '%d') pday,
            '履历材料' ptype,
            remark,
            sort,
            del_time
        FROM
            archives_material_info
        WHERE
                p_no = #{pno,jdbcType=VARCHAR}
 
        UNION ALL
            SELECT
                p_date,
                p_no,
                p_name,
                page_num,
                DATE_FORMAT(p_date, '%Y') pyear,
                DATE_FORMAT(p_date, '%m') pmonth,
                DATE_FORMAT(p_date, '%d') pday,
                '自传材料' ptype,
                remark,
                sort,
                del_time
            FROM
                archives_my_info
            WHERE
                p_no = #{pno,jdbcType=VARCHAR}
            UNION ALL
                SELECT
                    p_date,
                    p_no,
                    p_name,
                    page_num,
                    DATE_FORMAT(p_date, '%Y') pyear,
                    DATE_FORMAT(p_date, '%m') pmonth,
                    DATE_FORMAT(p_date, '%d') pday,
                    '鉴定考核考察材料' ptype,
                    remark,
                    sort,
                    del_time
                FROM
                    archives_kh_info
                WHERE
                    p_no = #{pno,jdbcType=VARCHAR}
                UNION ALL
                    (
                        SELECT
                            p_date,
                            p_no,
                            p_name,
                            page_num,
                            DATE_FORMAT(p_date, '%Y') pyear,
                            DATE_FORMAT(p_date, '%m') pmonth,
                            DATE_FORMAT(p_date, '%d') pday,
                            (
                                CASE
                                WHEN p_type = '1' THEN
                                    '学历学位材料'
                                WHEN p_type = '2' THEN
                                    '技术职务材料'
                                WHEN p_type = '3' THEN
                                    '科研学术材料'
                                WHEN p_type = '4' THEN
                                    '培训材料'
                                END
                            ) ptype,
                            remark,
                            sort,
                            del_time
                        FROM
                            archives_pro_info
                        WHERE
                            p_no = #{pno,jdbcType=VARCHAR}
                        ORDER BY
                            p_type
                    )
                UNION ALL
                    SELECT
                        p_date,
                        p_no,
                        p_name,
                        page_num,
                        DATE_FORMAT(p_date, '%Y') pyear,
                        DATE_FORMAT(p_date, '%m') pmonth,
                        DATE_FORMAT(p_date, '%d') pday,
                        '政审材料' ptype,
                        remark,
                        sort,
                        del_time
                    FROM
                        archives_political_info
                    WHERE
                        p_no = #{pno,jdbcType=VARCHAR}
                    UNION ALL
                        SELECT
                            p_date,
                            p_no,
                            p_name,
                            page_num,
                            DATE_FORMAT(p_date, '%Y') pyear,
                            DATE_FORMAT(p_date, '%m') pmonth,
                            DATE_FORMAT(p_date, '%d') pday,
                            '党团材料' ptype,
                            remark,
                            sort,
                            del_time
                        FROM
                            archives_pt_info
                        WHERE
                            p_no = #{pno,jdbcType=VARCHAR}
                        UNION ALL
                            SELECT
                                p_date,
                                p_no,
                                p_name,
                                page_num,
                                DATE_FORMAT(p_date, '%Y') pyear,
                                DATE_FORMAT(p_date, '%m') pmonth,
                                DATE_FORMAT(p_date, '%d') pday,
                                '奖励材料' ptype,
                                remark,
                                sort,
                                del_time
                            FROM
                                archives_reward_info
                            WHERE
                                    p_no = #{pno,jdbcType=VARCHAR}
                            UNION ALL
                                SELECT
                                    p_date,
                                    p_no,
                                    p_name,
                                    page_num,
                                    DATE_FORMAT(p_date, '%Y') pyear,
                                    DATE_FORMAT(p_date, '%m') pmonth,
                                    DATE_FORMAT(p_date, '%d') pday,
                                    '处分材料' ptype,
                                    remark,
                                    sort,
                                    del_time
                                FROM
                                    archives_disciplined_info
                                WHERE
                                    p_no = #{pno,jdbcType=VARCHAR}
                                UNION ALL
                                    (
                                        SELECT
                                            p_date,
                                            p_no,
                                            p_name,
                                            page_num,
                                            DATE_FORMAT(p_date, '%Y') pyear,
                                            DATE_FORMAT(p_date, '%m') pmonth,
                                            DATE_FORMAT(p_date, '%d') pday,
                                            (
                                                CASE
                                                WHEN p_type = '1' THEN
                                                    '工资材料'
                                                WHEN p_type = '2' THEN
                                                    '任免材料'
                                                WHEN p_type = '3' THEN
                                                    '出国材料'
                                                WHEN p_type = '4' THEN
                                                    '会议材料'
                                                END
                                            ) ptype,
                                            remark,
                                            sort,
                                            del_time
                                        FROM
                                            archives_out_info
                                        WHERE
                                            p_no = #{pno,jdbcType=VARCHAR}
                                        ORDER BY
                                            p_type
                                    )
                                UNION ALL
                                    SELECT
                                        p_date,
                                        p_no,
                                        p_name,
                                        page_num,
                                        DATE_FORMAT(p_date, '%Y') pyear,
                                        DATE_FORMAT(p_date, '%m') pmonth,
                                        DATE_FORMAT(p_date, '%d') pday,
                                        '其他材料' ptype,
                                        remark,
                                        sort,
                                        del_time
                                    FROM
                                        archives_other_info
                                    WHERE
                                        p_no = #{pno,jdbcType=VARCHAR} and del_time is null order by sort 

    ) material

WHERE del_time IS NULL
ORDER BY
    sort
   </select>
  
  <select id="selectAllGdMaterialsByPno_old" resultType="java.util.HashMap" parameterType="java.lang.String">
SELECT
	*
FROM
	(
		SELECT
			p_date,
			p_no,
			p_name,
			page_num,
			DATE_FORMAT(p_date, '%Y') pyear,
			DATE_FORMAT(p_date, '%m') pmonth,
			DATE_FORMAT(p_date, '%d') pday,
			'履历材料' ptype,
			remark,
			sort,
			del_time
		FROM
			archives_material_info
		UNION ALL
			SELECT
				p_date,
				p_no,
				p_name,
				page_num,
				DATE_FORMAT(p_date, '%Y') pyear,
				DATE_FORMAT(p_date, '%m') pmonth,
				DATE_FORMAT(p_date, '%d') pday,
				'自传材料' ptype,
				remark,
				sort,
				del_time
			FROM
				archives_my_info
			UNION ALL
				SELECT
					p_date,
					p_no,
					p_name,
					page_num,
					DATE_FORMAT(p_date, '%Y') pyear,
					DATE_FORMAT(p_date, '%m') pmonth,
					DATE_FORMAT(p_date, '%d') pday,
					'鉴定考核考察材料' ptype,
					remark,
					sort,
					del_time
				FROM
					archives_kh_info
				UNION ALL
					(
						SELECT
							p_date,
							p_no,
							p_name,
							page_num,
							DATE_FORMAT(p_date, '%Y') pyear,
							DATE_FORMAT(p_date, '%m') pmonth,
							DATE_FORMAT(p_date, '%d') pday,
							(
								CASE
								WHEN p_type = '1' THEN
									'学历学位材料'
								WHEN p_type = '2' THEN
									'技术职务材料'
								WHEN p_type = '3' THEN
									'科研学术材料'
								WHEN p_type = '4' THEN
									'培训材料'
								END
							) ptype,
							remark,
							sort,
							del_time
						FROM
							archives_pro_info
						ORDER BY
							p_type
					)
				UNION ALL
					SELECT
						p_date,
						p_no,
						p_name,
						page_num,
						DATE_FORMAT(p_date, '%Y') pyear,
						DATE_FORMAT(p_date, '%m') pmonth,
						DATE_FORMAT(p_date, '%d') pday,
						'政审材料' ptype,
						remark,
						sort,
						del_time
					FROM
						archives_political_info
					UNION ALL
						SELECT
							p_date,
							p_no,
							p_name,
							page_num,
							DATE_FORMAT(p_date, '%Y') pyear,
							DATE_FORMAT(p_date, '%m') pmonth,
							DATE_FORMAT(p_date, '%d') pday,
							'党团材料' ptype,
							remark,
							sort,
							del_time
						FROM
							archives_pt_info
						UNION ALL
							SELECT
								p_date,
								p_no,
								p_name,
								page_num,
								DATE_FORMAT(p_date, '%Y') pyear,
								DATE_FORMAT(p_date, '%m') pmonth,
								DATE_FORMAT(p_date, '%d') pday,
								'奖励材料' ptype,
								remark,
								sort,
								del_time
							FROM
								archives_reward_info
							UNION ALL
								SELECT
									p_date,
									p_no,
									p_name,
									page_num,
									DATE_FORMAT(p_date, '%Y') pyear,
									DATE_FORMAT(p_date, '%m') pmonth,
									DATE_FORMAT(p_date, '%d') pday,
									'处分材料' ptype,
									remark,
									sort,
									del_time
								FROM
									archives_disciplined_info
								UNION ALL
									(
										SELECT
											p_date,
											p_no,
											p_name,
											page_num,
											DATE_FORMAT(p_date, '%Y') pyear,
											DATE_FORMAT(p_date, '%m') pmonth,
											DATE_FORMAT(p_date, '%d') pday,
											(
												CASE
												WHEN p_type = '1' THEN
													'工资材料'
												WHEN p_type = '2' THEN
													'任免材料'
												WHEN p_type = '3' THEN
													'出国材料'
												WHEN p_type = '4' THEN
													'会议材料'
												END
											) ptype,
											remark,
											sort,
											del_time
										FROM
											archives_out_info
										ORDER BY
											p_type
									)
								UNION ALL
									SELECT
										p_date,
										p_no,
										p_name,
										page_num,
										DATE_FORMAT(p_date, '%Y') pyear,
										DATE_FORMAT(p_date, '%m') pmonth,
										DATE_FORMAT(p_date, '%d') pday,
										'其他材料' ptype,
										remark,
										sort,
										del_time
									FROM
										archives_other_info

	) material
WHERE
	p_no = #{pno,jdbcType=VARCHAR}
AND del_time IS NULL
ORDER BY
	sort

  </select>
  
   <update id="sort" parameterType="com.i84.earnpoint.gdcl.BO.SerchBO">
   update archives_material_info 
      set sort =  #{sort,jdbcType=INTEGER}
      where id=#{id,jdbcType=INTEGER}
  </update>
  
   <update id="delete_cl" parameterType="java.util.HashMap">
   update 
   <if test="type==1">
   archives_material_info 
   </if>
   <if test="type==2">
   archives_my_info
   </if>
   <if test="type==3">
   archives_kh_info
   </if>
   <if test="type==4">
   archives_pro_info
   </if>
   <if test="type==5">
   archives_political_info
   </if>
   <if test="type==6">
   archives_pt_info
   </if>
   <if test="type==7">
  	archives_reward_info
   </if>
   <if test="type==8">
   archives_disciplined_info
   </if>
   <if test="type==9">
   archives_out_info
   </if>
   <if test="type==10">
   archives_other_info
   </if>
      set del_time =  #{time,jdbcType=INTEGER}
      where id=#{id,jdbcType=INTEGER}
  </update>
  
  
  <select id="getsort" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  select sort from archives_material_info 
  where p_no=#{pno,jdbcType=VARCHAR}
  ORDER BY sort DESC limit 1
  </select>
</mapper>