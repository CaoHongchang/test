<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.i84.earnpoint.mapper.UserPartyInfoMapper">
  <resultMap id="BaseResultMap" type="com.i84.earnpoint.model.UserPartyInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="uid" jdbcType="INTEGER" property="uid" />
    <result column="pno" jdbcType="VARCHAR" property="pno" />
    <result column="is_state" jdbcType="CHAR" property="isState" />
    <result column="company" jdbcType="VARCHAR" property="company" />
    <result column="is_in" jdbcType="CHAR" property="isIn" />
    <result column="in_date" jdbcType="TIMESTAMP" property="inDate" />
    <result column="out_date" jdbcType="TIMESTAMP" property="outDate" />
    <result column="party_date" jdbcType="TIMESTAMP" property="partyDate" />
    <result column="m_his" jdbcType="REAL" property="mHis" />
    <result column="his_date" jdbcType="TIMESTAMP" property="hisDate" />
    <result column="add_m" jdbcType="REAL" property="addM" />
    <result column="need_m" jdbcType="REAL" property="needM" />
    <result column="m" jdbcType="REAL" property="m" />
    <result column="full_date" jdbcType="TIMESTAMP" property="fullDate" />
    <result column="j_name1" jdbcType="VARCHAR" property="jName1" />
    <result column="j_name2" jdbcType="VARCHAR" property="jName2" />
    <result column="sq_status" jdbcType="VARCHAR" property="sqStatus" />
    <result column="rd_status" jdbcType="VARCHAR" property="rdStatus" />
    <result column="zz_mtr" jdbcType="VARCHAR" property="zzMtr" />
    <result column="py_mtr" jdbcType="VARCHAR" property="pyMtr" />
    <result column="full_rq" jdbcType="VARCHAR" property="fullRq" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="er_msg" jdbcType="VARCHAR" property="erMsg" />
    <result column="del_date" jdbcType="TIMESTAMP" property="delDate" />
    <result column="jf_date" jdbcType="TIMESTAMP" property="jfDate" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, uid, pno, is_state, company, is_in, in_date, out_date, party_date, m_his, his_date, 
    add_m, need_m, m, full_date, j_name1, j_name2, sq_status, rd_status, zz_mtr, py_mtr, 
    full_rq, remark, er_msg, del_date, jf_date
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from user_party_info
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from user_party_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.i84.earnpoint.model.UserPartyInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_party_info (id, uid, pno, 
      is_state, company, is_in, in_date, 
      out_date, party_date, m_his, 
      his_date, add_m, need_m, m, 
      full_date, j_name1, j_name2, 
      sq_status, rd_status, zz_mtr, 
      py_mtr, full_rq, remark, 
      er_msg, del_date, jf_date
      )
    values (#{id,jdbcType=INTEGER}, #{uid,jdbcType=INTEGER}, #{pno,jdbcType=VARCHAR}, 
      #{isState,jdbcType=CHAR}, #{company,jdbcType=VARCHAR}, #{isIn,jdbcType=CHAR}, #{inDate,jdbcType=TIMESTAMP}, 
      #{outDate,jdbcType=TIMESTAMP}, #{partyDate,jdbcType=TIMESTAMP}, #{mHis,jdbcType=REAL}, 
      #{hisDate,jdbcType=TIMESTAMP}, #{addM,jdbcType=REAL}, #{needM,jdbcType=REAL}, #{m,jdbcType=REAL}, 
      #{fullDate,jdbcType=TIMESTAMP}, #{jName1,jdbcType=VARCHAR}, #{jName2,jdbcType=VARCHAR}, 
      #{sqStatus,jdbcType=VARCHAR}, #{rdStatus,jdbcType=VARCHAR}, #{zzMtr,jdbcType=VARCHAR}, 
      #{pyMtr,jdbcType=VARCHAR}, #{fullRq,jdbcType=VARCHAR}, #{remark,jdbcType=VARCHAR}, 
      #{erMsg,jdbcType=VARCHAR}, #{delDate,jdbcType=TIMESTAMP}, #{jfDate,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.i84.earnpoint.model.UserPartyInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_party_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="uid != null">
        uid,
      </if>
      <if test="pno != null">
        pno,
      </if>
      <if test="isState != null">
        is_state,
      </if>
      <if test="company != null">
        company,
      </if>
      <if test="isIn != null">
        is_in,
      </if>
      <if test="inDate != null">
        in_date,
      </if>
      <if test="outDate != null">
        out_date,
      </if>
      <if test="partyDate != null">
        party_date,
      </if>
      <if test="mHis != null">
        m_his,
      </if>
      <if test="hisDate != null">
        his_date,
      </if>
      <if test="addM != null">
        add_m,
      </if>
      <if test="needM != null">
        need_m,
      </if>
      <if test="m != null">
        m,
      </if>
      <if test="fullDate != null">
        full_date,
      </if>
      <if test="jName1 != null">
        j_name1,
      </if>
      <if test="jName2 != null">
        j_name2,
      </if>
      <if test="sqStatus != null">
        sq_status,
      </if>
      <if test="rdStatus != null">
        rd_status,
      </if>
      <if test="zzMtr != null">
        zz_mtr,
      </if>
      <if test="pyMtr != null">
        py_mtr,
      </if>
      <if test="fullRq != null">
        full_rq,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="erMsg != null">
        er_msg,
      </if>
      <if test="delDate != null">
        del_date,
      </if>
      <if test="jfDate != null">
        jf_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="uid != null">
        #{uid,jdbcType=INTEGER},
      </if>
      <if test="pno != null">
        #{pno,jdbcType=VARCHAR},
      </if>
      <if test="isState != null">
        #{isState,jdbcType=CHAR},
      </if>
      <if test="company != null">
        #{company,jdbcType=VARCHAR},
      </if>
      <if test="isIn != null">
        #{isIn,jdbcType=CHAR},
      </if>
      <if test="inDate != null">
        #{inDate,jdbcType=TIMESTAMP},
      </if>
      <if test="outDate != null">
        #{outDate,jdbcType=TIMESTAMP},
      </if>
      <if test="partyDate != null">
        #{partyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="mHis != null">
        #{mHis,jdbcType=REAL},
      </if>
      <if test="hisDate != null">
        #{hisDate,jdbcType=TIMESTAMP},
      </if>
      <if test="addM != null">
        #{addM,jdbcType=REAL},
      </if>
      <if test="needM != null">
        #{needM,jdbcType=REAL},
      </if>
      <if test="m != null">
        #{m,jdbcType=REAL},
      </if>
      <if test="fullDate != null">
        #{fullDate,jdbcType=TIMESTAMP},
      </if>
      <if test="jName1 != null">
        #{jName1,jdbcType=VARCHAR},
      </if>
      <if test="jName2 != null">
        #{jName2,jdbcType=VARCHAR},
      </if>
      <if test="sqStatus != null">
        #{sqStatus,jdbcType=VARCHAR},
      </if>
      <if test="rdStatus != null">
        #{rdStatus,jdbcType=VARCHAR},
      </if>
      <if test="zzMtr != null">
        #{zzMtr,jdbcType=VARCHAR},
      </if>
      <if test="pyMtr != null">
        #{pyMtr,jdbcType=VARCHAR},
      </if>
      <if test="fullRq != null">
        #{fullRq,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="erMsg != null">
        #{erMsg,jdbcType=VARCHAR},
      </if>
      <if test="delDate != null">
        #{delDate,jdbcType=TIMESTAMP},
      </if>
      <if test="jfDate != null">
        #{jfDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.i84.earnpoint.model.UserPartyInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_party_info
    <set>
      <if test="uid != null">
        uid = #{uid,jdbcType=INTEGER},
      </if>
      <if test="pno != null">
        pno = #{pno,jdbcType=VARCHAR},
      </if>
      <if test="isState != null">
        is_state = #{isState,jdbcType=CHAR},
      </if>
      <if test="company != null">
        company = #{company,jdbcType=VARCHAR},
      </if>
      <if test="isIn != null">
        is_in = #{isIn,jdbcType=CHAR},
      </if>
      <if test="inDate != null">
        in_date = #{inDate,jdbcType=TIMESTAMP},
      </if>
      <if test="outDate != null">
        out_date = #{outDate,jdbcType=TIMESTAMP},
      </if>
      <if test="partyDate != null">
        party_date = #{partyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="mHis != null">
        m_his = #{mHis,jdbcType=REAL},
      </if>
      <if test="hisDate != null">
        his_date = #{hisDate,jdbcType=TIMESTAMP},
      </if>
      <if test="addM != null">
        add_m = #{addM,jdbcType=REAL},
      </if>
      <if test="needM != null">
        need_m = #{needM,jdbcType=REAL},
      </if>
      <if test="m != null">
        m = #{m,jdbcType=REAL},
      </if>
      <if test="fullDate != null">
        full_date = #{fullDate,jdbcType=TIMESTAMP},
      </if>
      <if test="jName1 != null">
        j_name1 = #{jName1,jdbcType=VARCHAR},
      </if>
      <if test="jName2 != null">
        j_name2 = #{jName2,jdbcType=VARCHAR},
      </if>
      <if test="sqStatus != null">
        sq_status = #{sqStatus,jdbcType=VARCHAR},
      </if>
      <if test="rdStatus != null">
        rd_status = #{rdStatus,jdbcType=VARCHAR},
      </if>
      <if test="zzMtr != null">
        zz_mtr = #{zzMtr,jdbcType=VARCHAR},
      </if>
      <if test="pyMtr != null">
        py_mtr = #{pyMtr,jdbcType=VARCHAR},
      </if>
      <if test="fullRq != null">
        full_rq = #{fullRq,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="erMsg != null">
        er_msg = #{erMsg,jdbcType=VARCHAR},
      </if>
      <if test="delDate != null">
        del_date = #{delDate,jdbcType=TIMESTAMP},
      </if>
      <if test="jfDate != null">
        jf_date = #{jfDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i84.earnpoint.model.UserPartyInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_party_info
    set uid = #{uid,jdbcType=INTEGER},
      pno = #{pno,jdbcType=VARCHAR},
      is_state = #{isState,jdbcType=CHAR},
      company = #{company,jdbcType=VARCHAR},
      is_in = #{isIn,jdbcType=CHAR},
      in_date = #{inDate,jdbcType=TIMESTAMP},
      out_date = #{outDate,jdbcType=TIMESTAMP},
      party_date = #{partyDate,jdbcType=TIMESTAMP},
      m_his = #{mHis,jdbcType=REAL},
      his_date = #{hisDate,jdbcType=TIMESTAMP},
      add_m = #{addM,jdbcType=REAL},
      need_m = #{needM,jdbcType=REAL},
      m = #{m,jdbcType=REAL},
      full_date = #{fullDate,jdbcType=TIMESTAMP},
      j_name1 = #{jName1,jdbcType=VARCHAR},
      j_name2 = #{jName2,jdbcType=VARCHAR},
      sq_status = #{sqStatus,jdbcType=VARCHAR},
      rd_status = #{rdStatus,jdbcType=VARCHAR},
      zz_mtr = #{zzMtr,jdbcType=VARCHAR},
      py_mtr = #{pyMtr,jdbcType=VARCHAR},
      full_rq = #{fullRq,jdbcType=VARCHAR},
      remark = #{remark,jdbcType=VARCHAR},
      er_msg = #{erMsg,jdbcType=VARCHAR},
      del_date = #{delDate,jdbcType=TIMESTAMP},
      jf_date = #{jfDate,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <select id="selectUserPartyList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT
			a.id,
			a.uid,
			a.pno,
			a.company,
			a.is_in,
			a.is_state,
			date_format(a.party_date, '%Y-%m-%d') party_date,
			date_format(a.full_date, '%Y-%m-%d') full_date,
			date_format(a.his_date,'%Y-%m-%d') his_date,
			a.j_name1,
			a.j_name2,
			a.sq_status,
			a.rd_status,
			a.zz_mtr,
			a.py_mtr,
			a.full_rq,
			date_format(a.in_date, '%Y-%m-%d') in_date,
			date_format(a.out_date, '%Y-%m-%d') out_date,
			b.name,
			b.jg_name,
			b.tel,
			b.sex,
			b.pnum,
			date_format(b.birth_date, '%Y-%m-%d') birth_date,
			b.domicile,
			b.degree,
			b.da_id,
			b.qq,
			b.wx
		FROM
			user_party_info a
			inner join user_info b on a.uid = b.id
		WHERE
			a.del_date is NULL
	    <if test="name !=null and name !=''">
	     and b.name like CONCAT('%',#{name},'%')  
	    </if>
	    <if test="company !=null and company !=''">
	     and a.company like CONCAT('%',#{company},'%')
	    </if>
	    <if test="tel !=null and tel !=''">
	     and b.tel like CONCAT('%',#{tel},'%')
	    </if>
	    <if test="uid !=null and uid !=''">
	     and a.uid = #{uid}
	    </if>
	    <if test="id !=null and id !=''">
	     and a.id = #{id}
	    </if>
	    <if test="pno !=null and pno !=''">
	     and a.pno = #{pno}
	    </if>
	    <if test="pnum !=null and pnum !=''">
	     and b.pnum = #{pnum}
	    </if>
	    <if test="sex !=null and sex !=''">
	     and b.sex = #{sex}
	    </if>
	    <if test="isState !=null and isState !=''">
	     and a.is_state = #{isState}
	    </if>
	    <if test="isIn !=null and isIn !=''">
	     and a.is_in = #{isIn}
	    </if>
	    <if test="ids !=null">
	      and a.id in 
	      <foreach close=")" collection="ids" index="index" item="item" open="(" separator=",">
		     #{item}
		  </foreach>
	    </if>
    </select>
     <insert id="insertSelectiveForKey" useGeneratedKeys="true" keyProperty="id"   parameterType="com.i84.earnpoint.model.UserPartyInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_party_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="uid != null">
        uid,
      </if>
      <if test="pno != null">
        pno,
      </if>
      <if test="isState != null">
        is_state,
      </if>
      <if test="company != null">
        company,
      </if>
      <if test="isIn != null">
        is_in,
      </if>
      <if test="inDate != null">
        in_date,
      </if>
      <if test="outDate != null">
        out_date,
      </if>
      <if test="partyDate != null">
        party_date,
      </if>
      <if test="mHis != null">
        m_his,
      </if>
      <if test="hisDate != null">
        his_date,
      </if>
      <if test="addM != null">
        add_m,
      </if>
      <if test="needM != null">
        need_m,
      </if>
      <if test="m != null">
        m,
      </if>
      <if test="fullDate != null">
        full_date,
      </if>
      <if test="jName1 != null">
        j_name1,
      </if>
      <if test="jName2 != null">
        j_name2,
      </if>
      <if test="sqStatus != null">
        sq_status,
      </if>
      <if test="rdStatus != null">
        rd_status,
      </if>
      <if test="zzMtr != null">
        zz_mtr,
      </if>
      <if test="pyMtr != null">
        py_mtr,
      </if>
      <if test="fullRq != null">
        full_rq,
      </if>
      <if test="remark != null">
        remark,
      </if>
      <if test="erMsg != null">
        er_msg,
      </if>
      <if test="delDate != null">
        del_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="uid != null">
        #{uid,jdbcType=INTEGER},
      </if>
      <if test="pno != null">
        #{pno,jdbcType=VARCHAR},
      </if>
      <if test="isState != null">
        #{isState,jdbcType=CHAR},
      </if>
      <if test="company != null">
        #{company,jdbcType=VARCHAR},
      </if>
      <if test="isIn != null">
        #{isIn,jdbcType=CHAR},
      </if>
      <if test="inDate != null">
        #{inDate,jdbcType=TIMESTAMP},
      </if>
      <if test="outDate != null">
        #{outDate,jdbcType=TIMESTAMP},
      </if>
      <if test="partyDate != null">
        #{partyDate,jdbcType=TIMESTAMP},
      </if>
      <if test="mHis != null">
        #{mHis,jdbcType=REAL},
      </if>
      <if test="hisDate != null">
        #{hisDate,jdbcType=TIMESTAMP},
      </if>
      <if test="addM != null">
        #{addM,jdbcType=REAL},
      </if>
      <if test="needM != null">
        #{needM,jdbcType=REAL},
      </if>
      <if test="m != null">
        #{m,jdbcType=REAL},
      </if>
      <if test="fullDate != null">
        #{fullDate,jdbcType=TIMESTAMP},
      </if>
      <if test="jName1 != null">
        #{jName1,jdbcType=VARCHAR},
      </if>
      <if test="jName2 != null">
        #{jName2,jdbcType=VARCHAR},
      </if>
      <if test="sqStatus != null">
        #{sqStatus,jdbcType=VARCHAR},
      </if>
      <if test="rdStatus != null">
        #{rdStatus,jdbcType=VARCHAR},
      </if>
      <if test="zzMtr != null">
        #{zzMtr,jdbcType=VARCHAR},
      </if>
      <if test="pyMtr != null">
        #{pyMtr,jdbcType=VARCHAR},
      </if>
      <if test="fullRq != null">
        #{fullRq,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="erMsg != null">
        #{erMsg,jdbcType=VARCHAR},
      </if>
      <if test="delDate != null">
        #{delDate,jdbcType=TIMESTAMP},
      </if>
    </trim>

  </insert>
  <select id="selectByPno" resultMap="BaseResultMap" parameterType="java.lang.String">
       select
       <include refid="Base_Column_List"/>
       from user_party_info where del_date is null and his_date is not null
       <if test="pno!=null">
          and pno = #{pno}
       </if>
  </select>
  <update id="updateHistoryDate" parameterType="com.i84.earnpoint.model.UserPartyInfo">
      update user_party_info
      <set>
      <if test="hisDate != null">
        his_date = #{hisDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where pno = #{pno,jdbcType=VARCHAR} and del_date is null
  </update>
  <select id="selectUserPartyInfoWidthPnum" resultType="java.util.HashMap" parameterType="java.util.HashMap">
     select 
         a.id,a.pno,a.is_state,date_format(a.party_date,'%Y-%m-%d') party_date,a.m_his,date_format(a.his_date,'%Y-%m-%d') his_date,a.add_m,a.need_m,a.m,b.pnum,b.name,b.sex
         from user_party_info a inner join user_info b on a.uid=b.id 
         where a.del_date is null 
         <if test="pnum!=null and pnum!=''">
           and b.pnum = #{pnum,jdbcType=VARCHAR}
         </if>
         <if test="pno!=null and pno!=''">
          and a.pno=#{pno,jdbcType=VARCHAR}
         </if>
         <if test="isIn!=null and isIn!=''">
           and a.is_in =#{isIn,jdbcType=CHAR}
         </if>
          <if test="name!=null and name!=''">
           and b.name = #{name,jdbcType=VARCHAR}
         </if>
          <if test="party_date!=null and party_date!=''">
           and date_format(a.party_date,'%Y-%m-%d') = date_format(#{party_date,jdbcType=TIMESTAMP},'%Y-%m-%d')
         </if>
          <if test="his_date!=null and his_date!=''">
           and date_format(a.his_date,'%Y-%m-%d') = date_format(#{his_date,jdbcType=TIMESTAMP},'%Y-%m-%d')
         </if>
        <if test="party_dateB!=null and party_dateB!=''">
         <![CDATA[
     and a.party_date>=CONCAT(#{party_dateB},' 00:00:00') 
     ]]>
         </if>
          <if test="party_dateE!=null and party_dateE!=''">
       <![CDATA[
       and a.party_date<=CONCAT(#{party_dateE},' 23:59:59')
        ]]>        
         </if>
          <if test="his_dateB!=null and his_dateB!=''">
<![CDATA[
     and a.his_date>=CONCAT(#{his_dateB},' 00:00:00') 
     ]]>        
      </if>
          <if test="his_dateE!=null and his_dateE!=''">
<![CDATA[
     and a.his_date<=CONCAT(#{his_dateE},' 23:59:59') 
     ]]>  
              </if>
         
  </select>
  <select id="selectUserPartyInfoByPnum" resultMap="BaseResultMap" parameterType="java.lang.String">
       select a.* from user_party_info a INNER JOIN user_info b
          ON a.uid = b.id
       WHERE a.del_date IS NULL AND b.pnum = #{pnum,jdbcType=VARCHAR} limit 1
  </select>
  <select id="getNextPno" resultType="java.lang.String">
	    SELECT
			*
		FROM
			(
				SELECT
					cast(substring(t.pno, 3) as SIGNED INTEGER) AS pno
				FROM
					user_party_info t
			) a
		WHERE
			a.pno IS NOT NULL
		ORDER BY
			a.pno DESC
		LIMIT 1
	</select>
</mapper>