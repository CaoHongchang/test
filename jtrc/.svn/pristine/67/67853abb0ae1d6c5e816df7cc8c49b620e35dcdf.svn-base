<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.i84.earnpoint.mapper.ArchivesBaseInfoMapper">
  <resultMap id="BaseResultMap" type="com.i84.earnpoint.model.ArchivesBaseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="s_code" jdbcType="VARCHAR" property="sCode" />
    <result column="p_no" jdbcType="VARCHAR" property="pNo" />
    <result column="p_state" jdbcType="VARCHAR" property="pState" />
    <result column="p_m" jdbcType="VARCHAR" property="pM" />
    <result column="p_type" jdbcType="VARCHAR" property="pType" />
    <result column="in_point" jdbcType="VARCHAR" property="inPoint" />
    <result column="in_date" jdbcType="TIMESTAMP" property="inDate" />
    <result column="out_p" jdbcType="VARCHAR" property="outP" />
    <result column="out_point" jdbcType="VARCHAR" property="outPoint" />
    <result column="out_date" jdbcType="TIMESTAMP" property="outDate" />
    <result column="out_method" jdbcType="VARCHAR" property="outMethod" />
    <result column="get_n" jdbcType="VARCHAR" property="getN" />
    <result column="get_name" jdbcType="VARCHAR" property="getName" />
    <result column="get_tel" jdbcType="VARCHAR" property="getTel" />
    <result column="stuff" jdbcType="INTEGER" property="stuff" />
    <result column="add_date" jdbcType="TIMESTAMP" property="addDate" />
    <result column="del_date" jdbcType="TIMESTAMP" property="delDate" />
    <result column="del_id" jdbcType="INTEGER" property="delId" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, s_code, p_no, p_state, p_m, p_type, in_point, in_date, out_p, out_point, out_date, 
    out_method, get_n, get_name, get_tel, stuff, add_date, del_date, del_id
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from archives_base_info
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from archives_base_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.i84.earnpoint.model.ArchivesBaseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into archives_base_info (id, s_code, p_no, 
      p_state, p_m, p_type, 
      in_point, in_date, out_p, 
      out_point, out_date, out_method, 
      get_n, get_name, get_tel, 
      stuff, add_date, del_date, 
      del_id)
    values (#{id,jdbcType=INTEGER}, #{sCode,jdbcType=VARCHAR}, #{pNo,jdbcType=VARCHAR}, 
      #{pState,jdbcType=VARCHAR}, #{pM,jdbcType=VARCHAR}, #{pType,jdbcType=VARCHAR}, 
      #{inPoint,jdbcType=VARCHAR}, #{inDate,jdbcType=TIMESTAMP}, #{outP,jdbcType=VARCHAR}, 
      #{outPoint,jdbcType=VARCHAR}, #{outDate,jdbcType=TIMESTAMP}, #{outMethod,jdbcType=VARCHAR}, 
      #{getN,jdbcType=VARCHAR}, #{getName,jdbcType=VARCHAR}, #{getTel,jdbcType=VARCHAR}, 
      #{stuff,jdbcType=INTEGER}, #{addDate,jdbcType=TIMESTAMP}, #{delDate,jdbcType=TIMESTAMP}, 
      #{delId,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.i84.earnpoint.model.ArchivesBaseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into archives_base_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="sCode != null">
        s_code,
      </if>
      <if test="pNo != null">
        p_no,
      </if>
      <if test="pState != null">
        p_state,
      </if>
      <if test="pM != null">
        p_m,
      </if>
      <if test="pType != null">
        p_type,
      </if>
      <if test="inPoint != null">
        in_point,
      </if>
      <if test="inDate != null">
        in_date,
      </if>
      <if test="outP != null">
        out_p,
      </if>
      <if test="outPoint != null">
        out_point,
      </if>
      <if test="outDate != null">
        out_date,
      </if>
      <if test="outMethod != null">
        out_method,
      </if>
      <if test="getN != null">
        get_n,
      </if>
      <if test="getName != null">
        get_name,
      </if>
      <if test="getTel != null">
        get_tel,
      </if>
      <if test="stuff != null">
        stuff,
      </if>
      <if test="addDate != null">
        add_date,
      </if>
      <if test="delDate != null">
        del_date,
      </if>
      <if test="delId != null">
        del_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="sCode != null">
        #{sCode,jdbcType=VARCHAR},
      </if>
      <if test="pNo != null">
        #{pNo,jdbcType=VARCHAR},
      </if>
      <if test="pState != null">
        #{pState,jdbcType=VARCHAR},
      </if>
      <if test="pM != null">
        #{pM,jdbcType=VARCHAR},
      </if>
      <if test="pType != null">
        #{pType,jdbcType=VARCHAR},
      </if>
      <if test="inPoint != null">
        #{inPoint,jdbcType=VARCHAR},
      </if>
      <if test="inDate != null">
        #{inDate,jdbcType=TIMESTAMP},
      </if>
      <if test="outP != null">
        #{outP,jdbcType=VARCHAR},
      </if>
      <if test="outPoint != null">
        #{outPoint,jdbcType=VARCHAR},
      </if>
      <if test="outDate != null">
        #{outDate,jdbcType=TIMESTAMP},
      </if>
      <if test="outMethod != null">
        #{outMethod,jdbcType=VARCHAR},
      </if>
      <if test="getN != null">
        #{getN,jdbcType=VARCHAR},
      </if>
      <if test="getName != null">
        #{getName,jdbcType=VARCHAR},
      </if>
      <if test="getTel != null">
        #{getTel,jdbcType=VARCHAR},
      </if>
      <if test="stuff != null">
        #{stuff,jdbcType=INTEGER},
      </if>
      <if test="addDate != null">
        #{addDate,jdbcType=TIMESTAMP},
      </if>
      <if test="delDate != null">
        #{delDate,jdbcType=TIMESTAMP},
      </if>
      <if test="delId != null">
        #{delId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.i84.earnpoint.model.ArchivesBaseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update archives_base_info
    <set>
      <if test="sCode != null">
        s_code = #{sCode,jdbcType=VARCHAR},
      </if>
      <if test="pNo != null">
        p_no = #{pNo,jdbcType=VARCHAR},
      </if>
      <if test="pState != null">
        p_state = #{pState,jdbcType=VARCHAR},
      </if>
      <if test="pM != null">
        p_m = #{pM,jdbcType=VARCHAR},
      </if>
      <if test="pType != null">
        p_type = #{pType,jdbcType=VARCHAR},
      </if>
      <if test="inPoint != null">
        in_point = #{inPoint,jdbcType=VARCHAR},
      </if>
      <if test="inDate != null">
        in_date = #{inDate,jdbcType=TIMESTAMP},
      </if>
      <if test="outP != null">
        out_p = #{outP,jdbcType=VARCHAR},
      </if>
      <if test="outPoint != null">
        out_point = #{outPoint,jdbcType=VARCHAR},
      </if>
      <if test="outDate != null">
        out_date = #{outDate,jdbcType=TIMESTAMP},
      </if>
      <if test="outMethod != null">
        out_method = #{outMethod,jdbcType=VARCHAR},
      </if>
      <if test="getN != null">
        get_n = #{getN,jdbcType=VARCHAR},
      </if>
      <if test="getName != null">
        get_name = #{getName,jdbcType=VARCHAR},
      </if>
      <if test="getTel != null">
        get_tel = #{getTel,jdbcType=VARCHAR},
      </if>
      <if test="stuff != null">
        stuff = #{stuff,jdbcType=INTEGER},
      </if>
      <if test="addDate != null">
        add_date = #{addDate,jdbcType=TIMESTAMP},
      </if>
      <if test="delDate != null">
        del_date = #{delDate,jdbcType=TIMESTAMP},
      </if>
      <if test="delId != null">
        del_id = #{delId,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i84.earnpoint.model.ArchivesBaseInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update archives_base_info
    set s_code = #{sCode,jdbcType=VARCHAR},
      p_no = #{pNo,jdbcType=VARCHAR},
      p_state = #{pState,jdbcType=VARCHAR},
      p_m = #{pM,jdbcType=VARCHAR},
      p_type = #{pType,jdbcType=VARCHAR},
      in_point = #{inPoint,jdbcType=VARCHAR},
      in_date = #{inDate,jdbcType=TIMESTAMP},
      out_p = #{outP,jdbcType=VARCHAR},
      out_point = #{outPoint,jdbcType=VARCHAR},
      out_date = #{outDate,jdbcType=TIMESTAMP},
      out_method = #{outMethod,jdbcType=VARCHAR},
      get_n = #{getN,jdbcType=VARCHAR},
      get_name = #{getName,jdbcType=VARCHAR},
      get_tel = #{getTel,jdbcType=VARCHAR},
      stuff = #{stuff,jdbcType=INTEGER},
      add_date = #{addDate,jdbcType=TIMESTAMP},
      del_date = #{delDate,jdbcType=TIMESTAMP},
      del_id = #{delId,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
   <select id="selectArchivesBaseInfoList1" parameterType="java.util.HashMap" resultType="java.util.HashMap">
		SELECT
			a.dpno,
			a.pno,
			c.`name`,
			c.pnum,
			c.tel,
			c.sex,
			a.is_s,d.realName as stuffName,c.school,c.major,c.tel userTel,
			b.id, b.s_code, b.p_no, b.p_state, b.p_m, b.p_type, b.in_point, DATE_FORMAT(b.in_date,'%Y-%m-%d') in_date, b.out_p, b.out_point, DATE_FORMAT(b.out_date,'%Y-%m-%d') out_date, 
    b.out_method, b.get_n,b.get_name, b.get_tel,b.stuff,DATE_FORMAT(b.add_date,'%Y-%m-%d')  add_date
		FROM
			user_mg_info a
		LEFT JOIN archives_base_info b ON b.p_no = a.dpno
		INNER JOIN user_info c ON c.id = a.uid
		LEFT JOIN t_user d ON d.userId = b.stuff
		WHERE a.del_date IS NULL AND c.del_date IS NULL and b.del_date is null 
	    <if test="p_no !=null and p_no !=''">
	        and b.p_no = #{p_no}
	    </if>
	    <if test="dpno != null">
	        AND a.dpno = #{dpno}
	    </if>
	     <if test="pnum != null">
	        AND c.pnum = #{pnum}
	    </if>
	      <if test="name!=null and name!=''">
	        AND c.name like concat('%',#{name},'%')
	    </if>
	    <if test="pState!=null and pState!=''">
	        AND b.p_state like concat('%',#{pState},'%')
	    </if>
	     <if test="start!=null and end!=null">
	        AND b.add_date between #{start} and #{end}
	    </if>
	    <if test="age!=null and age!=''">
	        <choose>
	           <when test="age == 30">
	           	  AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=30
	           </when>
	           <when test="age == 40">
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=31 AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=40
	           </when>
	           <when test="age == 50">
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=41 AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=50
	           </when>
	           <otherwise>
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=51
	           </otherwise>
	        </choose>
	       
	    </if>
	    group by a.dpno
	    order by b.add_date desc
    </select>
  <select id="selectArchivesBaseInfoList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
SELECT
	c.pnum,
	c.tel,
	c.tel userTel,
	c.name,
	c.sex,
	c.school,
	c.major,
	c.dpno,
	d.realName AS stuffName,
	b.id,
	b.p_no,
	b.p_state,
	b.p_m,
	b.p_type,
	b.in_point,
	DATE_FORMAT(b.in_date, '%Y-%m-%d') in_date,
	b.out_p,
	b.out_point,
	DATE_FORMAT(b.out_date, '%Y-%m-%d') out_date,
	b.out_method,
	b.get_n,
	b.get_name,
	b.get_tel,
	DATE_FORMAT(b.add_date, '%Y-%m-%d') add_date
FROM
user_info c
LEFT JOIN archives_base_info b ON b.p_no = c.dpno
LEFT JOIN t_user d ON d.userId = b.stuff
where  c.del_date IS NULL and b.del_date is null 
	    <if test="p_no !=null and p_no !=''">
	        and b.p_no = #{p_no}
	    </if>
	    <if test="dpno != null">
	        AND c.dpno = #{dpno}
	    </if>
	     <if test="pnum != null">
	        AND c.pnum = #{pnum}
	    </if>
	      <if test="name!=null and name!=''">
	        AND c.name like concat('%',#{name},'%')
	    </if>
	    <if test="pState!=null and pState!=''">
	        AND b.p_state like concat('%',#{pState},'%')
	    </if>
	     <if test="start!=null and end!=null">
	        AND b.add_date between #{start} and #{end}
	    </if>
	    <if test="age!=null and age!=''">
	        <choose>
	           <when test="age == 30">
	           	  AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=30
	           </when>
	           <when test="age == 40">
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=31 AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=40
	           </when>
	           <when test="age == 50">
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=41 AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=50
	           </when>
	           <otherwise>
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=51
	           </otherwise>
	        </choose>
	       
	    </if>
    </select>
    
    <select id="getcllist" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    SELECT
	a.pnum,
	a.tel,
	a.tel userTel,
	b.pno,
	a.dpno,
	a.name,
	a.pnum,
	a.sex,
	b.is_s,
	a.school,
	a.major,
	b.id,
    a.id as uid,
    b.id as aid
	FROM
		user_info a
	LEFT JOIN user_mg_info b ON a.id = b.uid where a.del_date IS NULL and b.del_date is null and a.dpno is not null
	    <if test="dpno != null">
	        AND a.dpno = #{dpno}
	    </if>
	     <if test="pnum != null">
	        AND a.pnum = #{pnum}
	    </if>
	      <if test="name!=null and name!=''">
	        AND a.name like concat('%',#{name},'%')
	    </if>
	    <if test="age!=null and age!=''">
	        <choose>
	           <when test="age == 30">
	           	  AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=30
	           </when>
	           <when test="age == 40">
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=31 AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=40
	           </when>
	           <when test="age == 50">
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=41 AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=50
	           </when>
	           <otherwise>
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=51
	           </otherwise>
	        </choose>
	       
	    </if>
    </select>
    
    <select id="sendByYear" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
    	<if test="timeType==null or timeType=='year'"> 
 			concat(YEAR(add_date),'年')  year,
 		</if>
 		<if test=" timeType=='month'"> 
 			concat(MONTH(add_date),'月') year,
 		</if>
 			 COUNT(b.`is_s`) num
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL AND  b.is_s='on'
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	        <if test="timeType==null or timeType=='year'"> 
 			 GROUP BY YEAR(add_date) 
 			</if>
	        <if test=" timeType=='month'"> 
 			 GROUP BY MONTH(add_date) 
 			</if>
    </select>
    
    <select id="sjdasltj" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
    	<if test="timeType==null or timeType=='year'"> 
 			concat(YEAR(add_date),'年')  year,
 		</if>
 		<if test=" timeType=='month'"> 
 			concat(MONTH(add_date),'月') year,
 		</if>
 			 COUNT(a.id) num
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL
  		    AND out_date IS  NULL
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>      
	        <if test="timeType==null or timeType=='year'"> 
 			 GROUP BY YEAR(add_date) 
 			</if>
	        <if test=" timeType=='month'"> 
 			 GROUP BY MONTH(add_date) 
 			</if>
    </select>
    
   <select id="rswbtj" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
    	<if test="timeType==null or timeType=='year'"> 
 			concat(YEAR(add_date),'年')  year,
 		</if>
 		<if test=" timeType=='month'"> 
 			concat(MONTH(add_date),'月') year,
 		</if>
 			 COUNT(a.id) num
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL 
  		    AND  b.`human_out`='on'
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	        <if test="timeType==null or timeType=='year'"> 
 			 GROUP BY YEAR(add_date) 
 			</if>
	        <if test=" timeType=='month'"> 
 			 GROUP BY MONTH(add_date) 
 			</if>
    </select>
    
    
    
    <select id="dwdltj" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
    	<if test="timeType==null or timeType=='year'"> 
 			concat(YEAR(add_date),'年')  year,
 		</if>
 		<if test=" timeType=='month'"> 
 			concat(MONTH(add_date),'月') year,
 		</if>
 			 COUNT(a.id) num
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL 
  		    AND  b.`point_proxy`='on'
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	        <if test="timeType==null or timeType=='year'"> 
 			 GROUP BY YEAR(add_date) 
 			</if>
	        <if test=" timeType=='month'"> 
 			 GROUP BY MONTH(add_date) 
 			</if>
    </select>
    
     <select id="xbtj" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
    	<if test="timeType==null or timeType=='year'"> 
 			concat(YEAR(add_date),'年')  year,
 		</if>
 		<if test=" timeType=='month'"> 
 			concat(MONTH(add_date),'月') year,
 		</if>
 			 COUNT(a.id) num
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL 
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	        <if test="timeType==null or timeType=='year'"> 
 			 GROUP BY YEAR(add_date) 
 			</if>
	        <if test=" timeType=='month'"> 
 			 GROUP BY MONTH(add_date) 
 			</if>
    </select>
    
     <select id="sex" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
			CASE WHEN `sex` IN('男','1') THEN '男'
			WHEN `sex` IN ('女', '0') THEN '女'
			ELSE `sex` END AS `sexes`,
			COUNT(a.id) num
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL 
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	         GROUP BY sexes
    </select>
    
    <select id="birthDate" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
    	<if test="timeType==null or timeType=='year'"> 
 			concat(YEAR(birth_date),'年')  year,
 		</if>
 		<if test=" timeType=='month'"> 
 			concat(MONTH(birth_date),'月') year,
 		</if>
 			 COUNT(a.id) num
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    <if test="year1 != null and year1 !='' " >
	        AND a.birth_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.birth_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	        <if test="timeType==null or timeType=='year'"> 
 			 GROUP BY YEAR(birth_date) 
 			</if>
	        <if test=" timeType=='month'"> 
 			 GROUP BY MONTH(birth_date) 
 			</if>
    </select>
    
     <select id="degree" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
 			 COUNT(a.id) num,
 			 degree
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL 
  		    and a.degree is not NULL
			and a.degree != ''
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	         GROUP BY degree
    </select>
    
    <select id="zzmm" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
 			 COUNT(a.id) num,
 			 zzmm
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL 
  		    and a.zzmm is not null
			and a.zzmm != ''
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	         GROUP BY zzmm
    </select>
    
    <select id="dtype" parameterType="com.i84.earnpoint.model.Statistical" resultType="java.util.HashMap" >
    	SELECT
 			 COUNT(a.id) num,
 			 dtype
 		 FROM
   			 user_info a 
    		 LEFT JOIN user_mg_info b 
     		 ON a.id = b.uid 
  		 WHERE a.del_date IS NULL 
    		AND b.del_date IS NULL 
  		    AND a.dpno IS NOT NULL 
  		    and b.dtype is not null
			and b.dtype != ''
  		    <if test="year1 != null and year1 !='' " >
	        AND a.add_date &gt;= #{year1}
	        </if>
	        <if test="year2 != null and year2 !=''" >
	        AND #{year2} &gt;= a.add_date
	        </if>
	        <if test="fileType==null or fileType=='sj'">
	        AND out_date IS  NULL
	        </if>
	         GROUP BY dtype
    </select>
    
     <select id="getcheckllist" parameterType="java.util.HashMap" resultType="java.util.HashMap">
    SELECT
	a.pnum,
	a.tel,
	a.tel userTel,
	b.pno,
	a.dpno,
	a.name,
	a.pnum,
	a.sex,
	b.is_s,
	a.school,
	a.major,
	b.id,
    a.id as uid,
    b.id as aid,
    c.p_state
	FROM
		user_info a
		LEFT JOIN archives_base_info c ON c.p_no = a.dpno
	LEFT JOIN user_mg_info b ON a.id = b.uid where a.del_date IS NULL and b.del_date is null and a.dpno is not null
	
	  <if test="dpno != null">
	        AND a.dpno = #{dpno}
	    </if>
	     <if test="pnum != null">
	        AND a.pnum = #{pnum}
	    </if>
	      <if test="name!=null and name!=''">
	        AND a.name like concat('%',#{name},'%')
	    </if>
	    <if test="age!=null and age!=''">
	        <choose>
	           <when test="age == 30">
	           	  AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=30
	           </when>
	           <when test="age == 40">
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=31 AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=40
	           </when>
	           <when test="age == 50">
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=41 AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &lt;=50
	           </when>
	           <otherwise>
	              AND FLOOR((DATEDIFF(CURRENT_DATE(),c.birth_date)/365)) &gt;=51
	           </otherwise>
	        </choose>
	       
	    </if>
     </select>
</mapper>