<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.i84.earnpoint.mapper.UserBgInfoMapper">
  <resultMap id="BaseResultMap" type="com.i84.earnpoint.model.UserBgInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="user_id" jdbcType="INTEGER" property="userId" />
    <result column="bg_department_id" jdbcType="VARCHAR" property="bgDepartmentId" />
    <result column="bg_enterpriser_id" jdbcType="INTEGER" property="bgEnterpriserId" />
    <result column="bg_activity_id" jdbcType="INTEGER" property="bgActivityId" />
    <result column="is_state" jdbcType="CHAR" property="isState" />
    <result column="rs" jdbcType="VARCHAR" property="rs" />
    <result column="up_state" jdbcType="CHAR" property="upState" />
    <result column="class_id" jdbcType="INTEGER" property="classId" />
    <result column="del_date" jdbcType="TIMESTAMP" property="delDate" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, user_id, bg_department_id, bg_enterpriser_id, bg_activity_id, is_state, rs, up_state, 
    class_id, del_date
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from user_bg_info
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from user_bg_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.i84.earnpoint.model.UserBgInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_bg_info (id, user_id, bg_department_id, 
      bg_enterpriser_id, bg_activity_id, is_state, 
      rs, up_state, class_id, 
      del_date)
    values (#{id,jdbcType=INTEGER}, #{userId,jdbcType=INTEGER}, #{bgDepartmentId,jdbcType=VARCHAR}, 
      #{bgEnterpriserId,jdbcType=INTEGER}, #{bgActivityId,jdbcType=INTEGER}, #{isState,jdbcType=CHAR}, 
      #{rs,jdbcType=VARCHAR}, #{upState,jdbcType=CHAR}, #{classId,jdbcType=INTEGER}, 
      #{delDate,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.i84.earnpoint.model.UserBgInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_bg_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="userId != null">
        user_id,
      </if>
      <if test="bgDepartmentId != null">
        bg_department_id,
      </if>
      <if test="bgEnterpriserId != null">
        bg_enterpriser_id,
      </if>
      <if test="bgActivityId != null">
        bg_activity_id,
      </if>
      <if test="isState != null">
        is_state,
      </if>
      <if test="rs != null">
        rs,
      </if>
      <if test="upState != null">
        up_state,
      </if>
      <if test="classId != null">
        class_id,
      </if>
      <if test="delDate != null">
        del_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="userId != null">
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="bgDepartmentId != null">
        #{bgDepartmentId,jdbcType=VARCHAR},
      </if>
      <if test="bgEnterpriserId != null">
        #{bgEnterpriserId,jdbcType=INTEGER},
      </if>
      <if test="bgActivityId != null">
        #{bgActivityId,jdbcType=INTEGER},
      </if>
      <if test="isState != null">
        #{isState,jdbcType=CHAR},
      </if>
      <if test="rs != null">
        #{rs,jdbcType=VARCHAR},
      </if>
      <if test="upState != null">
        #{upState,jdbcType=CHAR},
      </if>
      <if test="classId != null">
        #{classId,jdbcType=INTEGER},
      </if>
      <if test="delDate != null">
        #{delDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.i84.earnpoint.model.UserBgInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_bg_info
    <set>
      <if test="userId != null">
        user_id = #{userId,jdbcType=INTEGER},
      </if>
      <if test="bgDepartmentId != null">
        bg_department_id = #{bgDepartmentId,jdbcType=VARCHAR},
      </if>
      <if test="bgEnterpriserId != null">
        bg_enterpriser_id = #{bgEnterpriserId,jdbcType=INTEGER},
      </if>
      <if test="bgActivityId != null">
        bg_activity_id = #{bgActivityId,jdbcType=INTEGER},
      </if>
      <if test="isState != null">
        is_state = #{isState,jdbcType=CHAR},
      </if>
      <if test="rs != null">
        rs = #{rs,jdbcType=VARCHAR},
      </if>
      <if test="upState != null">
        up_state = #{upState,jdbcType=CHAR},
      </if>
      <if test="classId != null">
        class_id = #{classId,jdbcType=INTEGER},
      </if>
      <if test="delDate != null">
        del_date = #{delDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i84.earnpoint.model.UserBgInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update user_bg_info
    set user_id = #{userId,jdbcType=INTEGER},
      bg_department_id = #{bgDepartmentId,jdbcType=VARCHAR},
      bg_enterpriser_id = #{bgEnterpriserId,jdbcType=INTEGER},
      bg_activity_id = #{bgActivityId,jdbcType=INTEGER},
      is_state = #{isState,jdbcType=CHAR},
      rs = #{rs,jdbcType=VARCHAR},
      up_state = #{upState,jdbcType=CHAR},
      class_id = #{classId,jdbcType=INTEGER},
      del_date = #{delDate,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update> 
  <resultMap id="UserBgInfoBaseResultMap" type="com.i84.earnpoint.model.BmbImport">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="class_id" jdbcType="VARCHAR" property="pno" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="pnum" jdbcType="VARCHAR" property="pnum" />
    <result column="tel" jdbcType="VARCHAR" property="tel" />
    <result column="sex" jdbcType="VARCHAR" property="sex" />
    <result column="mz" jdbcType="VARCHAR" property="mz" />
    <result column="party_name" jdbcType="VARCHAR" property="partyName" />
    <result column="work_name" jdbcType="VARCHAR" property="workName" />
    <result column="bg_department_id" jdbcType="VARCHAR" property="bgDepartmentId" />
    <result column="place_name" jdbcType="VARCHAR" property="placeName" />
    <result column="birth_date" jdbcType="VARCHAR" property="brith" />
    <result column="domicile_place" jdbcType="INTEGER" property="domicilePlace" />
    <result column="degree" jdbcType="VARCHAR" property="degree" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
    <result column="pno_name" jdbcType="VARCHAR" property="bName" />
    <result column="rs" jdbcType="VARCHAR" property="rs" />
    <result column="cj" jdbcType="VARCHAR" property="cj" />
    <result column="xs" jdbcType="VARCHAR" property="xs" />
    <result column="is_state" jdbcType="VARCHAR" property="isState" />
    <result column="technical" jdbcType="VARCHAR" property="technical" />
  </resultMap>
   
  
  <select id="queryUserBgInfoByParam" parameterType="java.util.Map" resultMap="UserBgInfoBaseResultMap">
     SELECT UBI.ID,
    		UBI.IS_STATE,
      		UI.NAME,
	        UI.PNUM,
	        UI.TEL,
	        UI.SEX,
	        UI.MZ,
	        UI.PARTY_NAME,
	        UI.WORK_NAME,
	        UI.PLACE_NAME,
	        UI.BIRTH_DATE,
	        UI.DOMICILE_PLACE,
	        UI.DEGREE,
	        UI.REMARK
		FROM USER_INFO UI ,USER_BG_INFO UBI,CLASS_INFO CI
		WHERE  UI.ID = UBI.USER_ID AND CI.ID = UBI.CLASS_ID
			AND UI.PNUM = #{pnum,jdbcType=VARCHAR}
			 <if test="pno != null">
		        AND CI.PNO = #{pno,jdbcType=INTEGER}
		     </if>
  </select>
  
   <select id="queryBmbList" resultMap="UserBgInfoBaseResultMap" parameterType="com.i84.earnpoint.model.BmbInfo">
     SELECT BG.ID,
     		BG.IS_STATE,
     		C.NAME AS PNO_NAME,
			U.NAME,
			U.PNUM,
			BG.USER_ID,
			U.TEL,
			U.WORK_NAME,
			BG.RS,
			USI.SCORE AS CJ,
			USI.STIME AS XS,
	        U.SEX,
	        U.MZ,
	        U.PARTY_NAME,
	        U.PLACE_NAME,
	        DATE_FORMAT(U.BIRTH_DATE,'%Y-%m') BIRTH_DATE,
	        U.DOMICILE_PLACE,
	        U.DEGREE,
	        U.REMARK,
	        U.technical,
	        U.PART_NAME BG_DEPARTMENT_ID
		FROM USER_BG_INFO BG 
		      LEFT JOIN USER_INFO U ON BG.USER_ID = U.ID
              LEFT JOIN  CLASS_INFO C ON BG.CLASS_ID = C.ID
              LEFT JOIN USER_SCORE_INFO USI ON BG.CLASS_ID = USI.CLASS_ID AND BG.USER_ID = USI.UID
              <where>
              	<if test="bName!=null and bName!='' ">
              		AND C.NAME LIKE CONCAT('%',#{bName},'%')  
              	</if>
              	<if test="name!=null and name!='' ">
              		AND U.NAME LIKE CONCAT('%',#{name},'%')  
              	</if>
              	<if test="pnum!=null and pnum!='' ">
              		AND U.PNUM  = #{pnum} 
              	</if>
              	<if test="tel!=null and tel!='' ">
              		AND U.TEL  = #{tel} 
              	</if>
              	<if test="workName!=null and workName!='' ">
              		AND U.WORK_NAME = #{workName} 
              	</if>
              	<if test="rs!=null">
              		AND BG.IS_STATE=#{rs}
              	</if>
              </where>
  </select>
   
   <select id="queryBmbList2" resultType="java.util.HashMap" parameterType="com.i84.earnpoint.model.BmbInfo">
     select bg.id,
     		bg.is_state,
     		c.name as pno_name,
			u.name,
			u.pnum,
			bg.user_id,
			u.tel,
			u.work_name,
			bg.rs,
			usi.score as cj,
			usi.stime as xs,
	        u.sex,
	        u.mz,
	        u.party_name,
	        u.place_name,
	        u.birth_date,
	        u.domicile_place,
	        u.degree,
	        u.remark,
	        u.technical,
	        u.part_name bg_department_id
		FROM USER_BG_INFO BG 
		      LEFT JOIN USER_INFO U ON BG.USER_ID = U.ID
              LEFT JOIN  CLASS_INFO C ON BG.CLASS_ID = C.ID
              LEFT JOIN USER_SCORE_INFO USI ON BG.CLASS_ID = USI.CLASS_ID AND BG.USER_ID = USI.UID
              <where>
              	<if test="bName!=null and bName!='' ">
              		AND C.NAME LIKE CONCAT('%',#{bName},'%')  
              	</if>
              	<if test="name!=null and name!='' ">
              		AND U.NAME LIKE CONCAT('%',#{name},'%')  
              	</if>
              	<if test="pnum!=null and pnum!='' ">
              		AND U.PNUM  = #{pnum} 
              	</if>
              	<if test="tel!=null and tel!='' ">
              		AND U.TEL  = #{tel} 
              	</if>
              	<if test="workName!=null and workName!='' ">
              		AND U.WORK_NAME = #{workName} 
              	</if>
              	<if test="rs!=null">
              		AND BG.IS_STATE=#{rs}
              	</if>
              </where>
  </select>
   
   
  <insert id="insertUserInfo" keyProperty="id" parameterType="com.i84.earnpoint.model.BmbImport" useGeneratedKeys="true">
    INSERT INTO USER_INFO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="name != null">
        NAME,
      </if>
      <if test="pnum != null">
        PNUM,
      </if>
      <if test="tel != null">
        TEL,
      </if>
      <if test="pwd != null">
        PWD,
      </if>
      <if test="sex != null">
        SEX,
      </if>
      <if test="mz != null">
        MZ,
      </if>
      <if test="partyName != null">
        PARTY_NAME,
      </if>
       <if test="workName != null">
        WORK_NAME,
      </if>
      <if test="placeName != null">
        PLACE_NAME,
      </if>
      <if test="brith != null">
        BIRTH_DATE,
      </if>
      <if test="domicilePlace != null">
        DOMICILE_PLACE,
      </if>
      <if test="degree != null">
        DEGREE,
      </if>
      <if test="remark != null">
        REMARK,
      </if>
       <if test="bgDepartmentId != null">
        PART_NAME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
       <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="pnum != null">
        #{pnum,jdbcType=VARCHAR},
      </if>
      <if test="tel != null">
        #{tel,jdbcType=VARCHAR},
      </if>
      <if test="pwd != null">
        #{pwd,jdbcType=VARCHAR},
      </if>
      <if test="sex != null">
        #{sex,jdbcType=VARCHAR},
      </if>
      <if test="mz != null">
        #{mz,jdbcType=VARCHAR},
      </if>
      <if test="partyName != null">
        #{partyName,jdbcType=VARCHAR},
      </if>
       <if test="workName != null">
        #{workName,jdbcType=VARCHAR},
      </if>
      <if test="placeName != null">
        #{placeName,jdbcType=VARCHAR},
      </if>
      <if test="brith != null">
        str_to_date(#{brith,jdbcType=VARCHAR},'%Y-%m'),
      </if>
      <if test="domicilePlace != null">
        #{domicilePlace,jdbcType=VARCHAR},
      </if>
      <if test="degree != null">
        #{degree,jdbcType=VARCHAR},
      </if>
      <if test="remark != null">
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="bgDepartmentId != null">
        #{bgDepartmentId,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  
  <insert id="insertUserBgInfo" parameterType="com.i84.earnpoint.model.UserBgInfo">
    INSERT INTO USER_BG_INFO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="userId != null">
        USER_ID,
      </if>
      <if test="bgDepartmentId != null">
        BG_DEPARTMENT_ID,
      </if>
      <if test="isState != null">
        IS_STATE,
      </if>
      <if test="classId != null">
        CLASS_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="userId != null">
       #{userId,jdbcType=INTEGER},
      </if>
      <if test="bgDepartmentId != null">
       #{bgDepartmentId,jdbcType=INTEGER},
      </if>
      <if test="isState != null">
        #{isState,jdbcType=VARCHAR},
      </if>
      <if test="classId != null">
       #{classId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  
  <select id="queryIsExistUserInfo" parameterType="com.i84.earnpoint.model.BmbImport" resultType="java.lang.Integer">
    SELECT  COUNT(UBI.CLASS_ID)
    FROM USER_BG_INFO UBI,USER_INFO UI
    WHERE 1=1 AND UBI.USER_ID = UI.ID
     <if test="pnum != null">
        AND UI.PNUM = #{pnum,jdbcType=VARCHAR}
      </if>
      <if test="classId != null">
        AND UBI.CLASS_ID = #{classId,jdbcType=VARCHAR}
      </if>
  </select>
  
  <update id="updateUserInfo" parameterType="com.i84.earnpoint.model.BmbImport">
	    UPDATE USER_INFO
			    SET NAME = #{name,jdbcType=VARCHAR},
			    SEX = #{sex,jdbcType=VARCHAR},
			    MZ = #{mz,jdbcType=VARCHAR},
			    PARTY_NAME = #{partyName,jdbcType=VARCHAR},
			    WORK_NAME = #{workName,jdbcType=VARCHAR},
			    PLACE_NAME = #{placeName,jdbcType=VARCHAR},
			    BIRTH_DATE = str_to_date(#{brith,jdbcType=VARCHAR},'%Y-%m'),
			    DOMICILE_PLACE = #{domicilePlace,jdbcType=VARCHAR},
			    DEGREE = #{degree,jdbcType=VARCHAR},
			    TEL = #{tel,jdbcType=VARCHAR},
			    REMARK = #{remark,jdbcType=VARCHAR},
			     TECHNICAL = #{technical,jdbcType=VARCHAR},
			     PART_NAME = #{bgDepartmentId,jdbcType=VARCHAR}
		WHERE PNUM = #{pnum,jdbcType=VARCHAR}   
  </update>
  
  <update id="updateUserBgInfo" parameterType="com.i84.earnpoint.model.BmbImport">
	    UPDATE USER_BG_INFO
		    SET BG_DEPARTMENT_ID = #{bgDepartmentId,jdbcType=INTEGER}
		WHERE USER_ID = #{userId,jdbcType=INTEGER}    
  </update>
  
  <update id="checkUserBgInfo" parameterType="java.util.Map">
	    UPDATE USER_BG_INFO
		    SET RS = #{checkRemark,jdbcType=VARCHAR},
		    IS_STATE = #{checkStatus,jdbcType=VARCHAR}
		WHERE ID = #{id}
  </update>
  
  <select id="qryUserBgInfo" parameterType="java.lang.Integer" resultMap="UserBgInfoBaseResultMap">
     SELECT UBI.ID,
    		UBI.IS_STATE 
		FROM USER_BG_INFO UBI 
		WHERE  USER_ID = #{uid,jdbcType=VARCHAR}
  </select>
  
  <update id="updateUserBgInfoState" parameterType="com.i84.earnpoint.model.UserBgInfo">
	    UPDATE USER_BG_INFO
		    SET IS_STATE = #{isState,jdbcType=VARCHAR}
		WHERE 1=1 AND IS_STATE != '2'
		 <if test="userId != null">
		 	AND USER_ID = #{userId,jdbcType=INTEGER} 
      	 </if>
         <if test="classId != null">
         	AND CLASS_ID = #{classId,jdbcType=INTEGER} 
         </if>
  </update>
  
</mapper>