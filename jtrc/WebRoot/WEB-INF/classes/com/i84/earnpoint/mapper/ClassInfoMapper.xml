<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.i84.earnpoint.mapper.ClassInfoMapper">
  <resultMap id="BaseResultMap" type="com.i84.earnpoint.model.ClassInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="pno" jdbcType="VARCHAR" property="pno" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="enterprise_name" jdbcType="VARCHAR" property="enterpriseName" />
    <result column="c_enterprise_name" jdbcType="VARCHAR" property="cEnterpriseName" />
    <result column="content" jdbcType="VARCHAR" property="content" />
    <result column="obj_id" jdbcType="VARCHAR" property="objId" />
    <result column="type_id" jdbcType="VARCHAR" property="typeId" />
    <result column="p_date" jdbcType="VARCHAR" property="pDate" />
    <result column="p_num" jdbcType="INTEGER" property="pNum" />
    <result column="s_date" jdbcType="TIMESTAMP" property="sDate" />
    <result column="e_date" jdbcType="TIMESTAMP" property="eDate" />
    <result column="cstate" jdbcType="INTEGER" property="cstate" />
    <result column="is_valid" jdbcType="INTEGER" property="isValid" />
    <result column="url1" jdbcType="VARCHAR" property="url1" />
    <result column="del_date" jdbcType="TIMESTAMP" property="delDate" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, pno, name, enterprise_name, c_enterprise_name, content, obj_id, type_id, p_date, 
    p_num, s_date, e_date, cstate, is_valid, url1, del_date
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from class_info
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from class_info
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.i84.earnpoint.model.ClassInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into class_info (id, pno, name, 
      enterprise_name, c_enterprise_name, content, 
      obj_id, type_id, p_date, 
      p_num, s_date, e_date, 
      cstate, is_valid, url1, 
      del_date)
    values (#{id,jdbcType=INTEGER}, #{pno,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, 
      #{enterpriseName,jdbcType=VARCHAR}, #{cEnterpriseName,jdbcType=VARCHAR}, #{content,jdbcType=VARCHAR}, 
      #{objId,jdbcType=VARCHAR}, #{typeId,jdbcType=VARCHAR}, #{pDate,jdbcType=VARCHAR}, 
      #{pNum,jdbcType=INTEGER}, #{sDate,jdbcType=TIMESTAMP}, #{eDate,jdbcType=TIMESTAMP}, 
      #{cstate,jdbcType=INTEGER}, #{isValid,jdbcType=INTEGER}, #{url1,jdbcType=VARCHAR}, 
      #{delDate,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.i84.earnpoint.model.ClassInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into class_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="pno != null">
        pno,
      </if>
      <if test="name != null">
        name,
      </if>
      <if test="enterpriseName != null">
        enterprise_name,
      </if>
      <if test="cEnterpriseName != null">
        c_enterprise_name,
      </if>
      <if test="content != null">
        content,
      </if>
      <if test="objId != null">
        obj_id,
      </if>
      <if test="typeId != null">
        type_id,
      </if>
      <if test="pDate != null">
        p_date,
      </if>
      <if test="pNum != null">
        p_num,
      </if>
      <if test="sDate != null">
        s_date,
      </if>
      <if test="eDate != null">
        e_date,
      </if>
      <if test="cstate != null">
        cstate,
      </if>
      <if test="isValid != null">
        is_valid,
      </if>
      <if test="url1 != null">
        url1,
      </if>
      <if test="delDate != null">
        del_date,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="pno != null">
        #{pno,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="enterpriseName != null">
        #{enterpriseName,jdbcType=VARCHAR},
      </if>
      <if test="cEnterpriseName != null">
        #{cEnterpriseName,jdbcType=VARCHAR},
      </if>
      <if test="content != null">
        #{content,jdbcType=VARCHAR},
      </if>
      <if test="objId != null">
        #{objId,jdbcType=VARCHAR},
      </if>
      <if test="typeId != null">
        #{typeId,jdbcType=VARCHAR},
      </if>
      <if test="pDate != null">
        #{pDate,jdbcType=VARCHAR},
      </if>
      <if test="pNum != null">
        #{pNum,jdbcType=INTEGER},
      </if>
      <if test="sDate != null">
        #{sDate,jdbcType=TIMESTAMP},
      </if>
      <if test="eDate != null">
        #{eDate,jdbcType=TIMESTAMP},
      </if>
      <if test="cstate != null">
        #{cstate,jdbcType=INTEGER},
      </if>
      <if test="isValid != null">
        #{isValid,jdbcType=INTEGER},
      </if>
      <if test="url1 != null">
        #{url1,jdbcType=VARCHAR},
      </if>
      <if test="delDate != null">
        #{delDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.i84.earnpoint.model.ClassInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update class_info
    <set>
      <if test="pno != null">
        pno = #{pno,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="enterpriseName != null">
        enterprise_name = #{enterpriseName,jdbcType=VARCHAR},
      </if>
      <if test="cEnterpriseName != null">
        c_enterprise_name = #{cEnterpriseName,jdbcType=VARCHAR},
      </if>
      <if test="content != null">
        content = #{content,jdbcType=VARCHAR},
      </if>
      <if test="objId != null">
        obj_id = #{objId,jdbcType=VARCHAR},
      </if>
      <if test="typeId != null">
        type_id = #{typeId,jdbcType=VARCHAR},
      </if>
      <if test="pDate != null">
        p_date = #{pDate,jdbcType=VARCHAR},
      </if>
      <if test="pNum != null">
        p_num = #{pNum,jdbcType=INTEGER},
      </if>
      <if test="sDate != null">
        s_date = #{sDate,jdbcType=TIMESTAMP},
      </if>
      <if test="eDate != null">
        e_date = #{eDate,jdbcType=TIMESTAMP},
      </if>
      <if test="cstate != null">
        cstate = #{cstate,jdbcType=INTEGER},
      </if>
      <if test="isValid != null">
        is_valid = #{isValid,jdbcType=INTEGER},
      </if>
      <if test="url1 != null">
        url1 = #{url1,jdbcType=VARCHAR},
      </if>
      <if test="delDate != null">
        del_date = #{delDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i84.earnpoint.model.ClassInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update class_info
    set pno = #{pno,jdbcType=VARCHAR},
      name = #{name,jdbcType=VARCHAR},
      enterprise_name = #{enterpriseName,jdbcType=VARCHAR},
      c_enterprise_name = #{cEnterpriseName,jdbcType=VARCHAR},
      content = #{content,jdbcType=VARCHAR},
      obj_id = #{objId,jdbcType=VARCHAR},
      type_id = #{typeId,jdbcType=VARCHAR},
      p_date = #{pDate,jdbcType=VARCHAR},
      p_num = #{pNum,jdbcType=INTEGER},
      s_date = #{sDate,jdbcType=TIMESTAMP},
      e_date = #{eDate,jdbcType=TIMESTAMP},
      cstate = #{cstate,jdbcType=INTEGER},
      is_valid = #{isValid,jdbcType=INTEGER},
      url1 = #{url1,jdbcType=VARCHAR},
      del_date = #{delDate,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update> 
  <resultMap id="ClassInfoBaseResultMap" type="com.i84.earnpoint.model.ClassInfo">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="pno" jdbcType="VARCHAR" property="pno" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="enterprise_name" jdbcType="VARCHAR" property="enterpriseName" />
    <result column="c_enterprise_name" jdbcType="VARCHAR" property="cEnterpriseName" />
    <result column="content" jdbcType="VARCHAR" property="content" />
    <result column="obj_id" jdbcType="VARCHAR" property="objId" />
    <result column="type_id" jdbcType="VARCHAR" property="typeId" />
    <result column="p_date" jdbcType="VARCHAR" property="pDate" />
    <result column="p_num" jdbcType="VARCHAR" property="pNum" />
    <result column="s_date" jdbcType="VARCHAR" property="sDate" />
    <result column="e_date" jdbcType="VARCHAR" property="eDate" />
    <result column="cstate" jdbcType="INTEGER" property="cstate" />
    <result column="is_valid" jdbcType="INTEGER" property="isValid" />
    <result column="url1" jdbcType="VARCHAR" property="url1" />
  </resultMap>
  <update id="updateClass" parameterType="com.i84.earnpoint.model.ClassInfo">
    UPDATE CLASS_INFO
	    SET 
	     <if test="url1 != null">
      		  URL1 = #{url1,jdbcType=VARCHAR},
         </if>
	       NAME = #{name,jdbcType=VARCHAR},
	       ENTERPRISE_NAME = #{enterpriseName,jdbcType=VARCHAR},
	       C_ENTERPRISE_NAME = #{cEnterpriseName,jdbcType=VARCHAR},
	       CONTENT = #{content,jdbcType=VARCHAR},
	       OBJ_ID = #{objId,jdbcType=INTEGER},
	       TYPE_ID = #{typeId,jdbcType=VARCHAR},
	       P_DATE =#{pDate,jdbcType=VARCHAR},
	       P_NUM = #{pNum,jdbcType=INTEGER},
	       S_DATE = #{sDate,jdbcType=VARCHAR},
	       E_DATE = #{eDate,jdbcType=VARCHAR}
	WHERE PNO = #{pno,jdbcType=VARCHAR}     
  </update>
  
  <update id="updateClassCstate" parameterType="map">
    UPDATE CLASS_INFO
	    SET 
	     CSTATE = #{cstate}
	where
		<if test="pno!=null and pno!='' ">
				PNO = #{pno}
		</if>
		<if test="id!=null">
				ID = #{id}
		</if>
  </update>
  
  <update id="disabledClass" parameterType="java.util.Map">
	    UPDATE CLASS_INFO
		    SET IS_VALID = #{isValid,jdbcType=INTEGER}
		WHERE ID = #{id,jdbcType=INTEGER}    
  </update>
  <select id="queryClassInfoByParam" parameterType="java.util.Map" resultType="com.i84.earnpoint.model.ClassInfo">
    SELECT ID,
   	 	PNO,
        NAME,
        ENTERPRISE_NAME,
        C_ENTERPRISE_NAME,
        CONTENT,
        OBJ_ID,
        TYPE_ID,
        P_DATE,
        P_NUM,
        STR_TO_DATE(S_DATE,'%Y-%m-%d') S_DATE,
        STR_TO_DATE(E_DATE,'%Y-%m-%d') E_DATE,
        CSTATE,
        IS_VALID
    FROM CLASS_INFO
    WHERE 1=1
     <if test="id != null">
        AND ID = #{id,jdbcType=INTEGER}
     </if>
     <if test="pno != null">
        AND PNO = #{pno,jdbcType=VARCHAR}  
      </if>
  </select>
  
  <select id="queryZxqkInfoByParam" parameterType="java.util.Map" resultType="java.util.Map">
    SELECT CI.ID,
   	 	CI.PNO,
        CI.NAME,
        CI.ENTERPRISE_NAME,
        CI.C_ENTERPRISE_NAME,
        CI.CONTENT,
        CI.OBJ_ID,
        CI.TYPE_ID,
        CI.P_DATE,
        CI.P_NUM,
        STR_TO_DATE(CI.S_DATE,'%Y-%m-%d') S_DATE,
        STR_TO_DATE(CI.E_DATE,'%Y-%m-%d') E_DATE,
        CI.CSTATE,
        CI.IS_VALID,
        CAI.ADVICE1,
		CAI.ADVICE2,
		CAI.ADVICE3,
		STR_TO_DATE(CAI.ADVICE_DATE,'%Y-%m-%d')  ADVICE_DATE,
        STR_TO_DATE(CAI.ADVICE_SDATE,'%Y-%m-%d') ADVICE_SDATE 
    FROM CLASS_INFO CI,CLASS_ACTION_INFO CAI
    WHERE CI.PNO = CAI.PNO
     <if test="pno != null">
        AND CI.PNO = #{pno,jdbcType=VARCHAR}  
      </if>
  </select>
  
  <insert id="insertClassInfo" parameterType="com.i84.earnpoint.model.ClassInfo">
    INSERT INTO CLASS_INFO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="pno != null">
        PNO,
      </if>
      <if test="name != null">
        NAME,
      </if>
      <if test="enterpriseName != null">
        ENTERPRISE_NAME,
      </if>
      <if test="cEnterpriseName != null">
        C_ENTERPRISE_NAME,
      </if>
      <if test="content != null">
        CONTENT,
      </if>
      <if test="objId != null">
        OBJ_ID,
      </if>
      <if test="typeId != null">
        TYPE_ID,
      </if>
       <if test="pDate != null">
        P_DATE,
      </if>
      <if test="pNum != null">
        P_NUM,
      </if>
      <if test="sDate != null">
        S_DATE,
      </if>
      <if test="eDate != null">
        E_DATE,
      </if>
      <if test="cstate != null">
        CSTATE,
      </if>
      <if test="isValid != null">
        IS_VALID,
      </if>
      <if test="url1 != null">
        URL1,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
       <if test="pno != null">
       #{pno,jdbcType=VARCHAR},
      </if>
      <if test="name != null">
       #{name,jdbcType=VARCHAR},
      </if>
      <if test="enterpriseName != null">
        #{enterpriseName,jdbcType=VARCHAR},
      </if>
      <if test="cEnterpriseName != null">
        #{cEnterpriseName,jdbcType=VARCHAR},
      </if>
      <if test="content != null">
        #{content,jdbcType=VARCHAR},
      </if>
      <if test="objId != null">
        #{objId,jdbcType=INTEGER},
      </if>
      <if test="typeId != null">
        #{typeId,jdbcType=VARCHAR},
      </if>
       <if test="pDate != null">
       #{pDate,jdbcType=VARCHAR},
      </if>
      <if test="pNum != null">
       #{pNum,jdbcType=INTEGER},
      </if>
      <if test="sDate != null">
       #{sDate,jdbcType=VARCHAR},
      </if>
      <if test="eDate != null">
       #{eDate,jdbcType=VARCHAR},
      </if>
      <if test="cstate != null">
        #{cstate,jdbcType=INTEGER},
      </if>
      <if test="isValid != null">
       #{isValid,jdbcType=INTEGER},
      </if>
       <if test="url1 != null">
        #{url1,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  <select id="isExistTheSameUserOfClass" parameterType="com.i84.earnpoint.model.UserScoreImportInfo" resultType="int">
  	   SELECT COUNT(*) FROM user_score_info WHERE class_id = #{classId}  AND uid=#{uid} and del_date is null
  </select>
  
  <select id="queryClassList" parameterType="com.i84.earnpoint.model.ClassInfo" resultMap="ClassInfoBaseResultMap">
    SELECT ID,
   	 	PNO,
        NAME,
        ENTERPRISE_NAME,
        C_ENTERPRISE_NAME,
        CONTENT,
        OBJ_ID,
        TYPE_ID,
        P_DATE,
        P_NUM,
        STR_TO_DATE(S_DATE,'%Y-%m-%d') S_DATE,
        STR_TO_DATE(E_DATE,'%Y-%m-%d') E_DATE,
        CSTATE,
        IS_VALID,
        URL1
    FROM CLASS_INFO WHERE 1=1
	    <if test="pno !=null and pno !=''">
	     AND PNO =#{pno,jdbcType=VARCHAR}
	    </if>  
	    <if test="name !=null and name !=''">
	     AND NAME like #{name}   
	    </if>
	     <if test="enterpriseName !=null and enterpriseName !=''">
	     AND ENTERPRISE_NAME like #{enterpriseName}   
	    </if>
	    <if test="cEnterpriseName !=null and cEnterpriseName !=''">
	     AND C_ENTERPRISE_NAME like #{cEnterpriseName}   
	    </if>
	    <if test="content !=null and content !=''">
	     AND CONTENT like #{content}   
	    </if>
	    <if test="objId !=null and objId !=''">
	     AND OBJ_ID like #{objId}   
	    </if>
	    <if test="typeId !=null and typeId !=''">
	     AND TYPE_ID =#{typeId}
	    </if>  
	    <if test="pDate !=null and pDate !=''">
	     AND P_DATE = #{pDate}   
	    </if>
	    <if test="pNum !=null and pNum !=''">
	     AND P_NUM = #{pNum}
	    </if>  
	    <if test="sDate !=null and sDate !=''">
	        <![CDATA[ AND S_DATE >=  date_format(#{sDate},'%Y-%m-%d')  ]]>     
	    </if>
	    <if test="eDate !=null and eDate !=''">
	        <![CDATA[AND E_DATE <=  date_format(#{eDate},'%Y-%m-%d')  ]]>     
	    </if>
	    <if test="cstate !=null and cstate !=''">
	     AND CSTATE = #{cstate}
	    </if>  
	    <if test="isValid !=null">
	     AND IS_VALID = #{isValid}
	    </if> 
	     ORDER BY S_DATE DESC
  </select>
  
  <select id = "selectClassActionInfoByPno" parameterType="string" resultType="int">
	select count(*) from class_action_info where pno = #{pno}
  </select> 
  
  <update id="updateClassActionInfo" parameterType="com.i84.earnpoint.model.ClassActionImportInfo">
     update class_action_info
    <set>
      <if test="advice1 != null">
        advice1 = #{advice1,jdbcType=VARCHAR},
      </if>
      <if test="advice2 != null">
        advice2 = #{advice2,jdbcType=VARCHAR},
      </if>
      <if test="adviceDate != null">
        advice_date = #{adviceDate,jdbcType=TIMESTAMP},
      </if>
      <if test="advice3 != null">
        advice3 = #{advice3,jdbcType=VARCHAR},
      </if>
      <if test="adviceSdate != null">
        advice_sdate = #{adviceSdate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where pno = #{pno}
  </update>
  
  <insert id="insertClassActionInfo" parameterType="com.i84.earnpoint.model.ClassActionImportInfo">
    INSERT INTO CLASS_ACTION_INFO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="pno != null">
        PNO,
      </if>
      <if test="advice1 != null">
        ADVICE1,
      </if>
      <if test="advice2 != null">
        ADVICE2,
      </if>
      <if test="adviceDate != null">
        ADVICE_DATE,
      </if>
      <if test="advice3 != null">
        ADVICE3,
      </if>
      <if test="adviceSdate != null">
        ADVICE_SDATE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
       <if test="pno != null">
        #{pno,jdbcType=VARCHAR},
      </if>
      <if test="advice1 != null">
        #{advice1,jdbcType=VARCHAR},
      </if>
      <if test="advice2 != null">
        #{advice2,jdbcType=VARCHAR},
      </if>
      <if test="adviceDate != null">
        str_to_date(#{adviceDate,jdbcType=VARCHAR},'%Y-%m-%d'),
      </if>
      <if test="advice3 != null">
        #{advice3,jdbcType=VARCHAR},
      </if>
      <if test="adviceSdate != null">
        str_to_date(#{adviceSdate,jdbcType=VARCHAR},'%Y-%m-%d'),
      </if>
    </trim>
  </insert>
  
  
   <insert id="inserUserScoreInfo" parameterType="com.i84.earnpoint.model.UserScoreImportInfo">
    INSERT INTO USER_SCORE_INFO
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="uid != null">
        UID,
      </if>
      <if test="score != null">
        SCORE,
      </if>
      <if test="stime != null">
        STIME,
      </if>
      <if test="remark != null">
        REMARK,
      </if>
      <if test="classId != null">
        CLASS_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
	      <if test="uid != null">
	        #{uid,jdbcType=VARCHAR},
	      </if>
	      <if test="score != null">
	       #{score,jdbcType=DOUBLE},
	      </if>
	      <if test="stime != null">
	        #{stime,jdbcType=INTEGER},
	      </if>
	      <if test="remark != null">
	        #{remark,jdbcType=VARCHAR},
	      </if>
	      <if test="classId != null">
        	#{classId,jdbcType=VARCHAR},
     	  </if>
    </trim>
  </insert>
  
  <update id="updateUserScoreInfo" parameterType="com.i84.earnpoint.model.UserScoreImportInfo">
    UPDATE 
        USER_SCORE_INFO 
    SET 
    	SCORE = #{score,jdbcType=DOUBLE},
    	STIME = #{stime,jdbcType=INTEGER},
    	REMARK = #{remark,jdbcType=VARCHAR}
    WHERE 
        uid = #{uid} and CLASS_ID = #{classId}
  </update>
  
  <select id="queryNdhz" parameterType="java.util.Map" resultType="java.util.Map">
    SELECT  
        CI.NAME,
        CI.ENTERPRISE_NAME,
        CI.CONTENT,
        CI.OBJ_ID,
        CI.P_DATE,
        STR_TO_DATE(CI.S_DATE,'%Y-%m-%d') S_DATE,
        IFNULL(C.CNT, 0) CNT
    FROM CLASS_INFO CI LEFT JOIN (SELECT CLASS_ID,COUNT(ID) AS CNT FROM USER_BG_INFO GROUP BY CLASS_ID) C
		ON CI.ID = C.CLASS_ID  
	WHERE 1=1
      <if test="startDate != null">
          <![CDATA[ AND CI.S_DATE >=  date_format(#{startDate},'%Y-%m-%d')  ]]> 
      </if>
      <if test="endDate != null">
          <![CDATA[ AND CI.S_DATE <=  date_format(#{endDate},'%Y-%m-%d')  ]]> 
      </if>
      <if test="cstate != null">
           AND CI.CSTATE = #{cstate}
      </if>
       
  </select>
  
  <select id="qryCntScore2StimeNull" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM (
			SELECT UBI.CLASS_ID,
				   USI.SCORE ,
			       USI.STIME 
		       FROM USER_BG_INFO UBI 
			   LEFT JOIN USER_SCORE_INFO USI
          		  ON UBI.USER_ID = USI.UID AND UBI.CLASS_ID  = USI.CLASS_ID
 			WHERE UBI.CLASS_ID = #{CLASSID} AND  UBI.del_date is NULL AND UBI.is_state != '2'
		) A 
	   WHERE A.SCORE IS NULL  or A.STIME IS NULL
  </select>
  
  
  <select id="countpxwcqk" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  	select cstate 'name',count(1) 'num' from (
		select 
			CASE cstate   
      		  WHEN  4 THEN '已完成' 
        		ELSE '进行中'
 				END AS cstate from class_info
 	where del_date is null AND cstate=4
 	<if test="t_start != '' ">
              AND s_date  &gt;=  #{t_start}
        </if>
        <if test=" t_end != ''  ">
              AND  e_date  &lt;=  #{t_end}
        </if>
	) as t1 group by t1.cstate
  </select>
  
  <select id="countpxryqktj" parameterType="java.util.HashMap" resultType="java.util.HashMap">
  select 
  <if test="file_type =='cxdw'">
    work_name 'name',
  </if>
   <if test="file_type =='xl'">
    degree 'name',
  </if>
   <if test="file_type =='zw'">
    place_name 'name',
  </if>
  count(1) 'num' from (
	select  
	 <if test="file_type =='cxdw'">
    work_name
  </if>
   <if test="file_type =='xl'">
    degree 
  </if>
   <if test="file_type =='zw'">
    place_name 
  </if>from user_info a LEFT JOIN user_bg_info b on a.id=b.user_id
	where a.del_date is NULL
		) as t1 group by
 <if test="file_type =='cxdw'">
    t1.work_name 
  </if>
   <if test="file_type =='xl'">
    t1.degree 
  </if>
   <if test="file_type =='zw'">
	 t1.place_name
 </if>
  </select>
</mapper>